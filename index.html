<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="一念起，天涯咫尺；一念灭，咫尺天涯。">
    

    <!--Author-->
    
        <meta name="author" content="newtrekWang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="生命在于折腾"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="一念起，天涯咫尺；一念灭，咫尺天涯。" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="生命在于折腾"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>生命在于折腾</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">生命在于折腾</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/04/05/排序/">
                java实现基础算法
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-04-05</span>
            
            
                <a href="http://yoursite.com/2017/04/05/排序/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/算法/">算法</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><h3 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h3><blockquote>
<p>原理就是打牌时排序的方法</p>
<h4 id="排序规则"><a href="#排序规则" class="headerlink" title="排序规则"></a>排序规则</h4><ul>
<li>取出未排序部分的开头元素赋值给临时保存数据的变量V.</li>
<li>在已排列的部分将所有比V大的元素向后移动一个位置</li>
<li>将取出的元素插入空位。</li>
</ul>
</blockquote>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] insert(<span class="keyword">int</span>[] a)&#123;</div><div class="line">        <span class="keyword">if</span> (a.length&lt;<span class="number">2</span>)&#123;</div><div class="line">            <span class="keyword">return</span> a;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> i=<span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> j=<span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> temp=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (i&lt;a.length)&#123;</div><div class="line">            temp=a[i];</div><div class="line">            <span class="keyword">for</span> (j=i-<span class="number">1</span>;((j&gt;=<span class="number">0</span>)&amp;&amp;(temp&lt;a[j]));j--)&#123;</div><div class="line">                    a[j+<span class="number">1</span>]=a[j];</div><div class="line">            &#125;</div><div class="line"><span class="comment">//            因为j已经上一次已经减一了</span></div><div class="line">            a[j+<span class="number">1</span>]=temp;</div><div class="line">            i++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>插入排序对于大规模的乱序数组，插入排序会很慢，因为它只会交换相邻的元素，元素只能一点一点的从数组的一段移动到另一端。</p>
</blockquote>
<h3 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h3><blockquote>
<p>希尔排序改进了插入排序这一问题，它交换不相邻的元素对数组进行局部排序，并最终用插入排序将局部有序的数组进行排序。希尔排序的思想就是使得数组中任意间隔h的元素都是有序的，这样的数组可以成为h有序数组。</p>
<h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] shellSort(<span class="keyword">int</span>[] a)&#123;</div><div class="line">        <span class="keyword">int</span> h=<span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> n=a.length;</div><div class="line">        <span class="keyword">while</span> (h&lt;n/<span class="number">3</span>)&#123;</div><div class="line">            h=<span class="number">3</span>*h+<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span> (h&gt;=<span class="number">1</span>)&#123;</div><div class="line"><span class="comment">//            增量为h的插入排序</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=h;i&lt;n;i++)&#123;</div><div class="line">                <span class="keyword">int</span> v=a[i];</div><div class="line">                <span class="keyword">int</span> j=i-h;</div><div class="line">                <span class="keyword">while</span> (j&gt;=<span class="number">0</span>&amp;&amp;a[j]&gt;v)&#123;</div><div class="line">                    a[j+h]=a[j];</div><div class="line">                    j-=h;</div><div class="line">                &#125;</div><div class="line">                a[j+h]=v;</div><div class="line">            &#125;</div><div class="line">            h=h/<span class="number">3</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</blockquote>
<h3 id="简单选择排序"><a href="#简单选择排序" class="headerlink" title="简单选择排序"></a>简单选择排序</h3><blockquote>
<p>基本思想：在要排序的一组数中，选出最小的一个数与第一个位置的数交换；然后在剩下的数当中再找最小的与第二个位置的数交换，如此循环到倒数第二个数和最后一个数比较为止。</p>
</blockquote>
<p><img src="http://ww4.sinaimg.cn/mw690/b254dc71gw1eu26zo9fosj20ex05lgm5.jpg" alt=""></p>
<h4 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] selectSort(<span class="keyword">int</span>[] a)&#123;</div><div class="line">        <span class="keyword">int</span> small=<span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> position=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;a.length;i++)&#123;</div><div class="line">            small=a[i];</div><div class="line">            position=i;</div><div class="line"><span class="comment">//            找出剩下的最小数并记录在small和position</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;a.length;j++)&#123;</div><div class="line">                <span class="keyword">if</span> (small&gt;a[j])&#123;</div><div class="line">                    small=a[j];</div><div class="line">                    position=j;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"><span class="comment">//            交换位置</span></div><div class="line">            a[position]=a[i];</div><div class="line">            a[i]=small;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h3><blockquote>
<p>在要排序的一组数中，对当前还未排好序的范围内的全部数，自上而下对相邻的两个数依次进行比较和调整，让较大的数往下沉，较小的往上冒。即：每当两相邻的数比较后发现它们的排序与排序要求相反时，就将它们互换。</p>
</blockquote>
<h4 id="代码实现-3"><a href="#代码实现-3" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] bubbleSort(<span class="keyword">int</span>[] a)&#123;</div><div class="line">      <span class="keyword">int</span> temp=<span class="number">0</span>;</div><div class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;a.length-<span class="number">1</span>;i++)&#123;</div><div class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;a.length-<span class="number">1</span>-i;j++)&#123;</div><div class="line">              <span class="keyword">if</span> (a[j]&gt;a[j+<span class="number">1</span>])&#123;</div><div class="line">                  temp=a[j];</div><div class="line">                  a[j]=a[j+<span class="number">1</span>];</div><div class="line">                  a[j+<span class="number">1</span>]=temp;</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> a;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/25/android IPC机制实现方式之AIDL/">
                android IPC机制实现方式之AIDL
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-25</span>
            
            
                <a href="http://yoursite.com/2017/03/25/android IPC机制实现方式之AIDL/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/AIDL/">AIDL</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="android-IPC机制实现方式之AIDL"><a href="#android-IPC机制实现方式之AIDL" class="headerlink" title="android IPC机制实现方式之AIDL"></a>android IPC机制实现方式之AIDL</h1><h3 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h3><blockquote>
<p>进程间通信或者跨进程通信，是指链各个进程之间进行数据交互的过程。</p>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><p>是CPU调度的最小丹云，同时线程是一种有限的资源；</p>
<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><p>是指一个执行单元，在PC和移动设备上是指一个程序或者一个应用，一个进程可以包含多个进程，因此进程和线程是包含和被包含的关系。</p>
<h2 id="IPC的使用场景"><a href="#IPC的使用场景" class="headerlink" title="IPC的使用场景"></a>IPC的使用场景</h2><p><strong>只有面对多进程时，才需要考虑进程间通信，多进程的情况分为两种：</strong></p>
<ul>
<li>.一个应用因为某些原因自身需要采用多进程模式来实现，比如：有些模块需要运行在单独的进程中，又或者是为了增大一个应用可使用的内存所以需要多进程来获取多份内存空间。</li>
<li>一个应用需要向其它应用获取数据，由于是两个应用，所以必须采用跨进程的方式来获取所需的数据，比如：通过ContentProvider对通讯录的增删改查。</li>
</ul>
</blockquote>
<h2 id="android中的多进程模式"><a href="#android中的多进程模式" class="headerlink" title="android中的多进程模式"></a>android中的多进程模式</h2><blockquote>
<ul>
<li>Android中的多进程是指一个应用中存在多个进程的，在Android中使用多进程的方法有且只有一种：就是给四大组件（Activity,Service,Receiver,ContentProvider)，在AndroidManifest中指定android:process属性,Android默认进程名是包名。</li>
<li>process属性的定义分为两种<ul>
<li>android:process=”com.xxx.xxxx.remote” 完整的命名方式，属于全局进程，其它应用通过ShareUID方式可以和它跑在同一个进程中。<ul>
<li>android:process=”:remote”，进程以“:”开头的进程属于当前应用的私有进程，其它应用的组件不可以和它跑在同一个进程中，“:”命名的进程会在当前的进程名之前附加上包名如：“com.xxx.xxxx:remote”。</li>
</ul>
</li>
</ul>
</li>
<li>UID：Android系统会为每个应用分配一个唯一的UID，具有相同UID的应用才能共享数据。如果两个应用通过ShareUID跑在同一个进程中，需要两个应用具有相同的shareUID并且相同的签名才可以。</li>
<li>多进程带来的问题<ul>
<li>.静态成员和单例模式完全失效</li>
<li>线程同步机制完全失效</li>
<li>SharePreference的可靠性下降</li>
<li>Application会多次创建</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="跨进程通信的方式"><a href="#跨进程通信的方式" class="headerlink" title="跨进程通信的方式"></a>跨进程通信的方式</h3><blockquote>
<ul>
<li>Intent传递数据</li>
<li>文件共享</li>
<li>Messenger</li>
<li>AIDL</li>
<li>ContentProvider</li>
<li>Socker<h3 id="小目标"><a href="#小目标" class="headerlink" title="小目标"></a>小目标</h3></li>
<li>会使用AIDL进行进程间通信</li>
<li>会手写AIDL的编码，加深对Binder机制的理解<h3 id="创建AIDL"><a href="#创建AIDL" class="headerlink" title="创建AIDL"></a>创建AIDL</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// IRemoteService.aidl</span></div><div class="line"><span class="keyword">package</span> com.newtrekwang.practices_sample;</div><div class="line"><span class="keyword">import</span> com.newtrekwang.practices_sample.Mydata;</div><div class="line"><span class="keyword">import</span> com.newtrekwang.practices_sample.IRemoteServiceCallBack;</div><div class="line"></div><div class="line"><span class="comment">// Declare any non-default types here with import statements</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IRemoteService</span> </span>&#123;</div><div class="line"></div><div class="line"> <span class="comment">/** Request the process ID of this service, to do evil things with it. */</span></div><div class="line">     <span class="function"><span class="keyword">int</span> <span class="title">getPid</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">killProcess</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="function">Mydata <span class="title">getData</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">startSomeThings</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">registerCallBack</span><span class="params">(IRemoteServiceCallBack cb)</span></span>;</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">unRegisterCallBack</span><span class="params">(IRemoteServiceCallBack cb)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat,</span></span></div><div class="line">            <span class="keyword">double</span> aDouble, String aString);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>这个接口文件是接口，定义了服务要实现的方法。如果有其它接口的话，也要另外定义并加import导入，服务要传输的对象数据也要另外定义并实现Parcelable接口。</p>
</blockquote>
<p>例：自定义Mydata类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.newtrekwang.practices_sample;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Parcel;</div><div class="line"><span class="keyword">import</span> android.os.Parcelable;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * The type Mydata.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Mydata</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Mydata</span><span class="params">(<span class="keyword">int</span> data1, <span class="keyword">int</span> data2)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data1 = data1;</div><div class="line">        <span class="keyword">this</span>.data2 = data2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Mydata&#123;"</span> +</div><div class="line">                <span class="string">"data1="</span> + data1 +</div><div class="line">                <span class="string">", data2="</span> + data2 +</div><div class="line">                <span class="string">'&#125;'</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> data1;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> data2;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Gets data 1.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> the data 1</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getData1</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets data 1.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> data1 the data 1</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData1</span><span class="params">(<span class="keyword">int</span> data1)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data1 = data1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Gets data 2.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> the data 2</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getData2</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets data 2.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> data2 the data 2</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData2</span><span class="params">(<span class="keyword">int</span> data2)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data2 = data2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Instantiates a new Mydata.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> in the in</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">Mydata</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">        readFromParcel(in);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * The constant CREATOR.</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Creator&lt;Mydata&gt; CREATOR = <span class="keyword">new</span> Creator&lt;Mydata&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Mydata <span class="title">createFromParcel</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Mydata(in);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="keyword">public</span> Mydata[] newArray(<span class="keyword">int</span> size) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Mydata[size];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 将数据写入到Parcel</div><div class="line">     **/</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel dest, <span class="keyword">int</span> flags)</span> </span>&#123;</div><div class="line">        dest.writeInt(data1);</div><div class="line">        dest.writeInt(data2);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 从Parcel中读取数据</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> in the in</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFromParcel</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">        data1 = in.readInt();</div><div class="line">        data2 = in.readInt();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>定义服务回调接口IRemoteServiceCallBack.aidl，也就是接口方法的实现在activity里<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.newtrekwang.practices_sample;</div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IRemoteServiceCallBack</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">valueChange</span><span class="params">(<span class="keyword">int</span> value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>定义MyData.aidl<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.newtrekwang.practices_sample;</div><div class="line">parcelable Mydata;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>然后AIDL接口定义好后，系统会自动生成对应的XXXService.Stub，感觉应该是Binder的代理，然后在你的Service里实例化一个，实现里面的方法，返回给onBinder();</p>
</blockquote>
<p>定义RemoteService.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"RemoteService&gt;&gt;&gt;&gt;&gt;"</span>;</div><div class="line">    Mydata mydata;</div><div class="line">    <span class="keyword">private</span> NotificationManager mNM;</div><div class="line">    <span class="keyword">private</span> IRemoteServiceCallBack remoteServiceCallback;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"onBind: !!!!!!!!!!"</span> );</div><div class="line">        <span class="keyword">return</span> mBinder;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line"></div><div class="line">        mNM= (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</div><div class="line">        showNotification();</div><div class="line">        Log.e(TAG, <span class="string">"onCreate: !!!!!!!!!!"</span> );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onUnbind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"onUnbind: !!!!!!!!!!!!"</span> );</div><div class="line">        showUnbindNotification();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onUnbind(intent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        mNM.cancel(R.string.hello);</div><div class="line">        Log.e(TAG, <span class="string">"onDestroy: !!!!!!!!!!!!"</span> );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IRemoteService.Stub mBinder=<span class="keyword">new</span> IRemoteService.Stub() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPid</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            <span class="keyword">return</span> Process.myPid();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">killProcess</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            Process.killProcess(Process.myPid());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Mydata <span class="title">getData</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Mydata(<span class="number">2</span>,<span class="number">4</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startSomeThings</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    Thread.sleep(<span class="number">3000</span>);</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">                Log.e(TAG, <span class="string">"startSomeThings: &gt;&gt;&gt;&gt;"</span>+i );</div><div class="line">                remoteServiceCallback.valueChange(i);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerCallBack</span><span class="params">(IRemoteServiceCallBack cb)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            remoteServiceCallback=cb;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unRegisterCallBack</span><span class="params">(IRemoteServiceCallBack cb)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            remoteServiceCallback=<span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat, <span class="keyword">double</span> aDouble, String aString)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showNotification</span><span class="params">()</span></span>&#123;</div><div class="line">        PendingIntent contentIntent=PendingIntent.getActivity(<span class="keyword">this</span>,<span class="number">0</span>, <span class="keyword">new</span> Intent(<span class="keyword">this</span>,Notification.class),<span class="number">0</span>);</div><div class="line">        Notification.Builder builder=<span class="keyword">new</span> Notification.Builder(<span class="keyword">this</span>);</div><div class="line">        builder.setSmallIcon(R.mipmap.ic_launcher)</div><div class="line">                .setTicker(<span class="string">"the service has start!"</span>)</div><div class="line">                .setContentIntent(contentIntent)</div><div class="line">                .setContentTitle(<span class="string">"RemoteService"</span>)</div><div class="line">                .setContentText(<span class="string">"点击后打开一个Activity！"</span>)</div><div class="line">                .setWhen(System.currentTimeMillis());</div><div class="line">        Notification noti=builder.build();</div><div class="line">        mNM.notify(R.string.hello,noti);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showUnbindNotification</span><span class="params">()</span></span>&#123;</div><div class="line">        Notification.Builder builder=<span class="keyword">new</span> Notification.Builder(<span class="keyword">this</span>);</div><div class="line">        builder.setSmallIcon(R.mipmap.ic_launcher)</div><div class="line">                .setTicker(<span class="string">"the service unBind"</span>)</div><div class="line">                .setContentTitle(<span class="string">"RemoteService"</span>)</div><div class="line">                .setContentText(<span class="string">"！"</span>)</div><div class="line">                .setWhen(System.currentTimeMillis());</div><div class="line">        Notification noti=builder.build();</div><div class="line">        mNM.notify(R.string.hello,noti);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在activity里请求绑定<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">    <span class="keyword">private</span> ServiceConnection mConnection=<span class="keyword">new</span> ServiceConnection() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</div><div class="line">            Log.e(TAG, <span class="string">"onServiceConnected: !!!!!!!!!!"</span> );</div><div class="line"><span class="comment">//            这里的IRemoteService.Stub.asInterface是关键，获取到了那个代理，以后想用服务</span></div><div class="line"><span class="comment">//            就找这个代理做事。</span></div><div class="line">            mService =IRemoteService.Stub.asInterface(service);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line"><span class="comment">//                注册回调</span></div><div class="line">                mService.registerCallBack(iRemoteServiceCallBack);</div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            mBound=<span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</div><div class="line">            Log.e(TAG, <span class="string">"onServiceDisconnected: !!!!!!!!!"</span> );</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line"><span class="comment">//                取消回调</span></div><div class="line">                mService.unRegisterCallBack(iRemoteServiceCallBack);</div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            mBound=<span class="keyword">false</span>;</div><div class="line">            mService=<span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line"><span class="comment">//                绑定服务</span></div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, RemoteService.class);</div><div class="line">                bindService(intent,mConnection,BIND_AUTO_CREATE);</div><div class="line"></div><div class="line"><span class="comment">//                解除绑定</span></div><div class="line">                <span class="keyword">if</span> (mBound)&#123;</div><div class="line">                    unbindService(mConnection);</div><div class="line">                &#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//                与服务绑定后，打印服务远程发来的数据</span></div><div class="line">                <span class="keyword">if</span> (mBound) &#123;</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                       Mydata mdata=mService.getData();</div><div class="line">                        Log.e(TAG, <span class="string">"onClick: &gt;&gt;&gt;&gt;"</span>+mdata.toString() );</div><div class="line">                    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>经结果验证，服务和activity的所在的进程是不同的，</p>
</blockquote>
<p><img src="http://ojgs96t5i.bkt.clouddn.com/QQ20170325173924.jpg" alt=""></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><blockquote>
<p>没怎么用Service，也不知道那些情况最好用跨进程的Service<br>不过看了下郭霖大神的博客，貌似有了些了解：</p>
<p><strong>不要把后台和子线程联系在一起就行了，这是两个完全不同的概念。Android的后台就是指，它的运行是完全不依赖UI的。即使Activity被销毁，或者程序被关闭，只要进程还在，Service就可以继续运行。比如说一些应用程序，始终需要与服务器之间始终保持着心跳连接，就可以使用Service来实现。你可能又会问，前面不是刚刚验证过Service是运行在主线程里的么？在这里一直执行着心跳连接，难道就不会阻塞主线程的运行吗？当然会，但是我们可以在Service中再创建一个子线程，然后在这里去处理耗时逻辑就没问题了。既然在Service里也要创建一个子线程，那为什么不直接在Activity里创建呢？这是因为Activity很难对Thread进行控制，当Activity被销毁之后，就没有任何其它的办法可以再重新获取到之前创建的子线程的实例。而且在一个Activity中创建的子线程，另一个Activity无法对其进行操作。但是Service就不同了，所有的Activity都可以与Service进行关联，然后可以很方便地操作其中的方法，即使Activity被销毁了，之后只要重新与Service建立关联，就又能够获取到原有的Service中Binder的实例。因此，使用Service来处理后台任务，Activity就可以放心地finish，完全不需要担心无法对后台任务进行控制的情况。</strong></p>
<p>那既然远程Service这么好用，干脆以后我们把所有的Service都转换成远程Service吧，还省得再开启线程了。其实不然，远程Service非但不好用，甚至可以称得上是较为难用。一般情况下如果可以不使用远程Service，就尽量不要使用它。</p>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/25/android四大组件之Service/">
                android四大组件之Service
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-25</span>
            
            
                <a href="http://yoursite.com/2017/03/25/android四大组件之Service/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/android四大组件/">android四大组件</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="android四大组件之Service"><a href="#android四大组件之Service" class="headerlink" title="android四大组件之Service"></a>android四大组件之Service</h1><h2 id="Service是什么？"><a href="#Service是什么？" class="headerlink" title="Service是什么？"></a>Service是什么？</h2><blockquote>
<p>Service是一个可以在后台执行长时间运行操作而不操作用户界面的应用组件。服务可由其它应用组件启动，而且即使用户切换到其它应用，服务仍将在后台继续运行。此外，组件可以绑定到服务，以与之进行交互，甚至是执行进程间通信（IPC）。例如，服务可以处理网络事物，播放音乐，执行文件I/O或与内容提供程序交互，而所有这一切均可在后台进行。</p>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>当应用组件啊（activity）通过调用startService（）启动服务时，服务即处于“启动状态”。一旦启动，服务即可在后台无限期运行，即时启动服务的组件已被销毁也不受影响。已启动的服务通常是执行单一操作，而且不会将结果返回给调用方。例如，它可能通过网络下载或上传文件。操作完成后，服务会自行停止运行。</p>
<h2 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h2><p>当应用组件通过调用bindService（）绑定服务时，服务即处于“绑定”状态。绑定服务提供了一个客户端-服务端接口，允许组件与服务进行交互，发送请求，获取结果，甚至是利用进程间通信跨进程执行这些操作。仅当与另一个应用组件绑定时，绑定服务才会运行。多个组件可以同时绑定到该服务，但全部取消绑定后，该服务即会被销毁。</p>
</blockquote>
<h2 id="应该是使用服务还是线程？"><a href="#应该是使用服务还是线程？" class="headerlink" title="应该是使用服务还是线程？"></a>应该是使用服务还是线程？</h2><blockquote>
<ul>
<li>服务是一种即时用户未与应用交互也可在后台运行的组件，因此，仅在必要是才创建服务。</li>
<li>如果确实要使用服务，则默认情况下，它仍会在应用的主线程中运行，因此，如果服务执行的是密集型或阻止性操作，则您仍应在服务内创建新线程。</li>
</ul>
</blockquote>
<h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><blockquote>
<ul>
<li><strong><em>onStartCommand()</em></strong>:当另一个组件（如 Activity）通过调用 startService() 请求启动服务时，系统将调用此方法。<strong><em>一旦执行此方法，服务即会启动并可在后台无限期运行</em></strong>。 如果您实现此方法，则在服务工作完成后，需要由您通过调用 stopSelf() 或 stopService() 来停止服务。（如果您只想提供绑定，则无需实现此方法。）</li>
<li><strong><em>onBind()</em></strong>:当另一个组件想通过调用 bindService() 与服务绑定（例如执行 RPC）时，系统将调用此方法。在此方法的实现中，<strong><em>您必须通过返回 IBinder 提供一个接口</em></strong>，供客户端用来与服务进行通信。请务必实现此方法，但如果您并不希望允许绑定，则应返回 null。</li>
<li><strong><em>onCreate()</em></strong>: 首次创建服务时，系统将调用此方法来执行一次性设置程序（在调用 onStartCommand() 或 onBind() 之前）。<strong><em>如果服务已在运行，则不会调用此方法</em></strong>。<br>-<strong><em>onDestroy()</em></strong>:当服务不再使用且将被销毁时，系统将调用此方法。服务应该实现此方法来清理所有资源，如线程、注册的侦听器、接收器等。 这是服务接收的最后一个调用。</li>
<li><strong><em>如果组件通过调用 startService() 启动服务（这会导致对 onStartCommand() 的调用），则服务将一直运行，直到服务使用 stopSelf() 自行停止运行，或由其他组件通过调用 stopService() 停止它为止;如果组件是通过调用 bindService() 来创建服务（且未调用 onStartCommand()，则服务只会在该组件与其绑定时运行。一旦该服务与所有客户端之间的绑定全部取消，系统便会销毁它</em></strong></li>
</ul>
</blockquote>
<h3 id="使用清单文件声明服务"><a href="#使用清单文件声明服务" class="headerlink" title="使用清单文件声明服务"></a>使用清单文件声明服务</h3><blockquote>
<p>要声明服务，请添加 <service> 元素作为 <application> 元素的子元素</application></service></p>
<h4 id="标签元素"><a href="#标签元素" class="headerlink" title="标签元素"></a>标签元素</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">android:description</span>=<span class="string">"string resource"</span></span></div><div class="line">         <span class="attr">android:directBootAware</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"]</div><div class="line">         <span class="attr">android:enabled</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"]</div><div class="line">         <span class="attr">android:exported</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"]</div><div class="line">         <span class="attr">android:icon</span>=<span class="string">"drawable resource"</span></div><div class="line">         <span class="attr">android:isolatedProcess</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"]</div><div class="line">         <span class="attr">android:label</span>=<span class="string">"string resource"</span></div><div class="line">         <span class="attr">android:name</span>=<span class="string">"string"</span></div><div class="line">         <span class="attr">android:permission</span>=<span class="string">"string"</span></div><div class="line">         <span class="attr">android:process</span>=<span class="string">"string"</span> &gt;</div><div class="line">    . . .</div><div class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li><strong>android:description</strong>:向用户描述服务的字符串(以字符串资源引用的方式)</li>
<li><strong>android:directBootAware</strong>：是否该服务是直接引导意识;也就是说，它是否可以在用户解锁设备之前运行。默认是FALSE</li>
<li><strong>android:enabled</strong>：要启用服务，application和service属性必须都为“true”（默认情况下都为true）</li>
<li><strong>android:exported</strong>：其他应用程序的组件是否可以调用服务或与其交互，当值为“false”时，只有同一个应用程序或具有相同用户ID的应用程序的组件可以启动该服务或绑定到该服务，如果有过滤器，默认值为true,反之则无。</li>
<li><strong>android:icon</strong>：表示服务的图标，这可能在查看应用管理的时候看得到。</li>
<li><strong>android:isolatedProcess</strong>：如果设置为true，此服务将在与系统其余部分隔离的特殊进程下运行，并且没有自己的权限。唯一的沟通是通过Service API（绑定和启动）</li>
<li><strong>android:label</strong>：可以向用户显示的服务的名称</li>
<li><strong>android:name</strong>：填定义的服务类</li>
<li><strong>android:permission</strong>：实体必须具有以启动服务或绑定到其的权限的名称，如果startService（），bindService（）或stopService（）的调用者未被授予此权限，则该方法将不会工作，并且Intent对象将不会传递到服务，如果未设置此属性，则由<application>元素的权限属性设置的权限将应用于服务。如果未设置任何属性，则服务不受权限保护。</application></li>
<li><strong>android:process</strong>：要运行服务的进程的名称。通常情况下，应用程序的所有组件在为应用程序创建的默认进程中运行，它与应用程序包具有相同的名称；如果分配给此属性的名称以冒号（’：’）开头，则在需要并且服务在该进程中运行时，将创建应用程序专用的新进程；如果进程名称以小写字符开头，则该服务将在该名称的全局进程中运行，前提是它具有这样做的权限。这允许不同应用程序中的组件共享进程，减少资源使用。</li>
</ul>
</blockquote>
<h3 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h3><blockquote>
<p>这是 Service 的子类，它使用工作线程逐一处理所有启动请求。如果您不要求服务同时处理多个请求，这是最好的选择。 您只需实现 onHandleIntent() 方法即可，该方法会接收每个启动请求的 Intent，使您能够执行后台工作。</p>
</blockquote>
<p>例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomService</span> <span class="keyword">extends</span> <span class="title">IntentService</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"CustomService&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * name是命名工作线程的，对debug有帮助</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomService</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(name);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomService</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"hello"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 服务创建时调用，服务正在运行不会调用</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        Log.e(TAG, <span class="string">"onCreate: !!!!!!!!!!!!"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 其它组件通过startServer后调用</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(@Nullable Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"onStartCommand: !!!!!!"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 服务启动时调用</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">(@Nullable Intent intent, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onStart(intent, startId);</div><div class="line">        Log.e(TAG, <span class="string">"onStart: !!!!!!!!"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个方法是在工作线程里执行的</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onHandleIntent</span><span class="params">(@Nullable Intent intent)</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"onHandleIntent: 当前线程："</span> + Thread.currentThread().getName());</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Thread.sleep(<span class="number">1000</span>);</div><div class="line">                System.out.println(<span class="string">"服务后台计数：》》"</span> + i);</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 服务销毁前的回调</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        System.out.println(<span class="string">"服务已完成！"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://ojgs96t5i.bkt.clouddn.com/QQ20170321215408.jpg" alt="启动服务结果"></p>
<blockquote>
<p>由启动服务结果可知：onCreate(),onStartCommand()等等服务的生命周期函数都是应用的主线程执行的，intentService封装的onHandleIntent是工作在工作线程的，证明intentService已经封装好了一个工程线程，而且任务结束后，服务会自动销毁。</p>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>这是适用于所有服务的基类。扩展此类时，必须创建一个用于执行所有服务工作的新线程，因为默认情况下，服务将使用应用的主线程，这会降低应用正在运行的所有 Activity 的性能，所以一般我们要自己实现一个workThread,推荐用IntentThread和handler实现。</p>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><ul>
<li>您可以通过将 Intent（指定要启动的服务）传递给 startService()，从 Activity 或其他应用组件启动服务。Android 系统调用服务的 onStartCommand() 方法，并向其传递 Intent。（切勿直接调用 onStartCommand()。）</li>
<li>多个服务启动请求会导致多次对服务的 onStartCommand() 进行相应的调用。但是，要停止服务，只需一个服务停止请求（使用 stopSelf() 或 stopService()）即可。</li>
</ul>
</blockquote>
<h3 id="停止服务"><a href="#停止服务" class="headerlink" title="停止服务"></a>停止服务</h3><blockquote>
<ul>
<li>启动服务必须管理自己的生命周期。也就是说，除非系统必须回收内存资源，否则系统不会停止或销毁服务，而且服务在 onStartCommand() 返回后会继续运行。因此，服务必须通过调用 stopSelf() 自行停止运行，或者由另一个组件通过调用 stopService() 来停止它。一旦请求使用 stopSelf() 或 stopService() 停止服务，系统就会尽快销毁服务。</li>
</ul>
</blockquote>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p><img src="https://developer.android.google.cn/images/service_lifecycle.png" alt=""></p>
<h3 id="绑定服务"><a href="#绑定服务" class="headerlink" title="绑定服务"></a>绑定服务</h3><blockquote>
<p>绑定服务是客户端-服务器接口中的服务器。绑定服务可让组件（例如 Activity）绑定到服务、发送请求、接收响应，甚至执行进程间通信 (IPC)。 绑定服务通常只在为其他应用组件服务时处于活动状态，不会无限期在后台运行。</p>
<ul>
<li>绑定服务是 Service 类的实现，可让其他应用与其绑定和交互。要提供服务绑定，您必须实现 onBind() 回调方法。该方法返回的 IBinder 对象定义了客户端用来与服务进行交互的编程接口。</li>
<li>客户端可通过调用 bindService() 绑定到服务。调用时，它必须提供 ServiceConnection 的实现，后者会监控与服务的连接。bindService() 方法会立即无值返回，但当 Android 系统创建客户端与服务之间的连接时，会对 ServiceConnection 调用 onServiceConnected()，向客户端传递用来与服务通信的 IBinder。</li>
<li>多个客户端可同时连接到一个服务。不过，只有在第一个客户端绑定时，系统才会调用服务的 onBind() 方法来检索 IBinder。系统随后无需再次调用 onBind()，便可将同一 IBinder 传递至任何其他绑定的客户端。</li>
<li>当最后一个客户端取消与服务的绑定时，系统会将服务销毁（除非 startService() 也启动了该服务）。</li>
</ul>
</blockquote>
<h3 id="创建绑定服务"><a href="#创建绑定服务" class="headerlink" title="创建绑定服务"></a>创建绑定服务</h3><blockquote>
<p>必须提供IBinder，用以提供客户端与服务惊醒交互的编程接口</p>
<ul>
<li><strong>扩展Binder类</strong>### 创建绑定服务<br>绑定服务允许应用组件通过调用 bindService() 与其绑定，以便创建长期连接（通常不允许组件通过调用 startService() 来启动它）；如果服务只是您的自有应用的后台工作线程，则优先采用这种方法。 不以这种方式创建接口的唯一原因是，您的服务被其他应用或不同的进程占用。</li>
<li><strong>使用Messenger</strong>如需让接口跨不同的进程工作，则可使用 Messenger 为服务创建接口。服务可以这种方式定义对应于不同类型 Message 对象的 Handler。此 Handler 是 Messenger 的基础，后者随后可与客户端分享一个 IBinder，从而让客户端能利用 Message 对象向服务发送命令。此外，客户端还可定义自有 Messenger，以便服务回传消息。这是执行进程间通信 (IPC) 的最简单方法，因为 Messenger 会在单一线程中创建包含所有请求的队列，这样您就不必对服务进行线程安全设计。</li>
<li><strong>使用AIDL</strong> AIDL（Android 接口定义语言）执行所有将对象分解成原语的工作，操作系统可以识别这些原语并将它们编组到各进程中，以执行 IPC。 之前采用 Messenger 的方法实际上是以 AIDL 作为其底层结构。 如上所述，Messenger 会在单一线程中创建包含所有客户端请求的队列，以便服务一次接收一个请求。 不过，如果您想让服务同时处理多个请求，则可直接使用 AIDL。 在此情况下，您的服务必须具备多线程处理能力，并采用线程安全式设计。如需直接使用 AIDL，您必须创建一个定义编程接口的 .aidl 文件。Android SDK 工具利用该文件生成一个实现接口并处理 IPC 的抽象类，您随后可在服务内对其进行扩展。</li>
</ul>
</blockquote>
<h5 id="扩展Binder类"><a href="#扩展Binder类" class="headerlink" title="扩展Binder类"></a>扩展Binder类</h5><blockquote>
<p>此方法只有在客户端和服务位于同一应用和进程内这一最常见的情况下方才有效。 例如，对于需要将 Activity 绑定到在后台播放音乐的自有服务的音乐应用，此方法非常有效。</p>
</blockquote>
<p>例子<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"LocalService&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IBinder mBinder = <span class="keyword">new</span> LocalBinder();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Random mGenerator = <span class="keyword">new</span> Random();</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 供客户端使用的类，因为我们知道服务通常是和客户端运行在一个线程，</div><div class="line">     * 所以我们不需要处理IPC，这里这个Binder类很像MVP里的中介者</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalBinder</span> <span class="keyword">extends</span> <span class="title">Binder</span> </span>&#123;</div><div class="line">        <span class="function">LocalService <span class="title">getService</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> LocalService.<span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"onCreate: !!!!!!!!!!"</span>);</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"onBind: !!!!!!!"</span>);</div><div class="line">        <span class="keyword">return</span> mBinder;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"onStartCommand: !!!!!!!!!!"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 供客户端调用的接口</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRandomNumber</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mGenerator.nextInt(<span class="number">100</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        Log.e(TAG, <span class="string">"onDestroy: !!!!!!!!!!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>绑定服务<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> ServiceConnection mConnection=<span class="keyword">new</span> ServiceConnection() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</div><div class="line">            Log.e(TAG, <span class="string">"onServiceConnected: !!!!!!!!!!"</span> );</div><div class="line">            mBound=<span class="keyword">true</span>;</div><div class="line">            LocalService.LocalBinder binder= (LocalService.LocalBinder) service;</div><div class="line"><span class="comment">//            取得对service实例的引用</span></div><div class="line">            localService=binder.getService();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</div><div class="line">            Log.e(TAG, <span class="string">"onServiceDisconnected: !!!!!!!!!"</span> );</div><div class="line">            mBound=<span class="keyword">false</span>;</div><div class="line">            localService=<span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line"></div><div class="line">Intent intent=<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,LocalService.class);</div><div class="line">                bindService(intent,mConnection, Context.BIND_AUTO_CREATE);</div></pre></td></tr></table></figure></p>
<p>取消绑定<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (mBound)&#123;</div><div class="line">                  unbindService(mConnection);</div><div class="line">                  mBound=<span class="keyword">false</span>;</div><div class="line">              &#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>所觉得这里的Service并没有多大的卵用，只是个分层的作用，而且接口很多。</p>
</blockquote>
<h5 id="使用Messenger"><a href="#使用Messenger" class="headerlink" title="使用Messenger"></a>使用Messenger</h5><blockquote>
<p>如需让服务与远程进程通信，则可使用 Messenger 为您的服务提供接口。利用此方法，您无需使用 AIDL 便可执行进程间通信 (IPC)。</p>
<ul>
<li>服务实现一个 Handler，由其接收来自客户端的每个调用的回调</li>
<li>Handler 用于创建 Messenger 对象（对 Handler 的引用）</li>
<li>Messenger 创建一个 IBinder，服务通过 onBind() 使其返回客户端</li>
<li>客户端使用 IBinder 将 Messenger（引用服务的 Handler）实例化，然后使用后者将 Message 对象发送给服务</li>
<li>服务在其 Handler 中（具体地讲，是在 handleMessage() 方法中）接收每个 Message。</li>
</ul>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/20/git学习笔记/">
                git学习笔记
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-20</span>
            
            
                <a href="http://yoursite.com/2017/03/20/git学习笔记/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/Git/">Git</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="git学习笔记"><a href="#git学习笔记" class="headerlink" title="git学习笔记"></a>git学习笔记</h2><h3 id="集中式和分布式版本控制系统有什么区别呢？"><a href="#集中式和分布式版本控制系统有什么区别呢？" class="headerlink" title="集中式和分布式版本控制系统有什么区别呢？"></a>集中式和分布式版本控制系统有什么区别呢？</h3><blockquote>
<p><strong><em>集中式版本控制系统</em></strong> 版本库是集中存放在中央服务器的，而干活的时候，用的都是自己的电脑，所以要先从中央服务器取得最新的版本，然后开始干活，干完活了，再把自己的活推送给中央服务器。中央服务器就好比是一个图书馆，你要改一本书，必须先从图书馆借出来，然后回到家自己改，改完了，再放回图书馆。</p>
</blockquote>
<p><img src="http://www.liaoxuefeng.com/files/attachments/001384860735706fd4c70aa2ce24b45a8ade85109b0222b000/0" alt=""></p>
<blockquote>
<p>集中式版本控制系统最大的毛病就是必须联网才能工作，如果在局域网内还好，带宽够大，速度够快，可如果在互联网上，遇到网速慢的话，可能提交一个10M的文件就需要5分钟，这还不得把人给憋死啊。</p>
<p><strong><em>分布式版本控制系统</em></strong>根本没有“中央服务器”，每个人的电脑上都是一个完整的版本库，这样，你工作的时候，就不需要联网了，因为版本库就在你自己的电脑上。既然每个人电脑上都有一个完整的版本库，那多个人如何协作呢？比方说你在自己电脑上改了文件A，你的同事也在他的电脑上改了文件A，这时，你们俩之间只需把各自的修改推送给对方，就可以互相看到对方的修改了。和集中式版本控制系统相比，分布式版本控制系统的安全性要高很多，因为每个人电脑里都有完整的版本库，某一个人的电脑坏掉了不要紧，随便从其他人那里复制一个就可以了。而集中式版本控制系统的中央服务器要是出了问题，所有人都没法干活了</p>
</blockquote>
<p><img src="http://www.liaoxuefeng.com/files/attachments/0013848607465969378d7e6d5e6452d8161cf472f835523000/0" alt=""></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><blockquote>
<p><strong><em>在Windows上安装Git</em></strong><br>Windows下要使用很多Linux/Unix的工具时，需要Cygwin这样的模拟环境，Git也一样。Cygwin的安装和配置都比较复杂，就不建议你折腾了。不过，有高人已经把模拟环境和Git都打包好了，名叫msysgit，只需要下载一个单独的exe安装程序，其他什么也不用装，绝对好用.msysgit是Windows版的Git，从<a href="https://git-for-windows.github.io下载" target="_blank" rel="external">https://git-for-windows.github.io下载</a><br>因为Git是分布式版本控制系统，所以，每个机器都必须自报家门：你的名字和Email地址。</p>
</blockquote>
<p>所以安装后，配置：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git config --global user.name <span class="string">"Your Name"</span></div><div class="line">$ git config --global user.email <span class="string">"email@example.com"</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意git config命令的–global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。</p>
</blockquote>
<h3 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h3><blockquote>
<p>什么是版本库呢？版本库又名仓库，英文名repository，你可以简单理解成一个目录，这个目录里面的所有文件都可以被Git管理起来，每个文件的修改、删除，Git都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻可以“还原”。<br>创建一个版本库非常简单，首先，选择一个合适的地方，创建一个空目录：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ mkdir learngit</div><div class="line">$ cd learngit</div><div class="line">$ pwd</div><div class="line">/Users/michael/learngit</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><em>pwd</em> 命令用于显示当前目录。</li>
<li>如果你使用Windows系统，为了避免遇到各种莫名其妙的问题，请确保目录名（包括父目录）不包含中文。<br>第二步，通过git init 命令把这个目录变成git可以管理的仓库：</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git init</div><div class="line">Initialized empty Git repository in /Users/michael/learngit/.git/</div></pre></td></tr></table></figure>
<h3 id="把文件添加到版本库"><a href="#把文件添加到版本库" class="headerlink" title="把文件添加到版本库"></a>把文件添加到版本库</h3><blockquote>
<ul>
<li>首先这里再明确一下，所有的版本控制系统，其实只能跟踪文本文件的改动，比如TXT文件，网页，所有的程序代码等等，Git也不例外。版本控制系统可以告诉你每次的改动，比如在第5行加了一个单词“Linux”，在第8行删了一个单词“Windows”。而图片、视频这些二进制文件，虽然也能由版本控制系统管理，但没法跟踪文件的变化，只能把二进制文件每次改动串起来，也就是只知道图片从100KB改成了120KB，但到底改了啥，版本控制系统不知道，也没法知道。</li>
<li>因为文本是有编码的，比如中文有常用的GBK编码，日文有Shift_JIS编码，如果没有历史遗留问题，强烈建议使用标准的UTF-8编码，所有语言使用同一种编码，既没有冲突，又被所有平台所支持。</li>
<li><strong>使用Windows的童鞋要特别注意：</strong>千万不要使用Windows自带的记事本编辑任何文本文件。原因是Microsoft开发记事本的团队使用了一个非常弱智的行为来保存UTF-8编码的文件，他们自作聪明地在每个文件开头添加了0xefbbbf（十六进制）的字符，你会遇到很多不可思议的问题，比如，网页第一行可能会显示一个“?”，明明正确的程序一编译就报语法错误，等等，都是由记事本的弱智行为带来的。建议你下载Notepad++代替记事本，不但功能强大，而且免费！记得把Notepad++的默认编码设置为UTF-8 without BOM即可：</li>
</ul>
</blockquote>
<p>例：放一个readme.txt</p>
<blockquote>
<p>用命令git add告诉Git，把文件添加到仓库<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git add readme.txt</div></pre></td></tr></table></figure></p>
<p>执行上面的命令，没有任何显示，这就对了，Unix的哲学是“没有消息就是好消息”，说明添加成功。</p>
<p>第二步，用命令git commit告诉Git，把文件提交到仓库：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git commit -m <span class="string">"wrote a readme file"</span></div><div class="line">[master (root-commit) cb926e7] wrote a readme file</div><div class="line"> <span class="number">1</span> file changed, <span class="number">2</span> insertions(+)</div><div class="line"> create mode <span class="number">100644</span> readme.txt</div></pre></td></tr></table></figure>
<blockquote>
<p>简单解释一下git commit命令，-m后面输入的是本次提交的说明，可以输入任意内容，当然最好是有意义的，这样你就能从历史记录里方便地找到改动记录。嫌麻烦不想输入-m “xxx”行不行？确实有办法可以这么干，但是强烈不建议你这么干，因为输入说明对自己对别人阅读都很重要。实在不想输入说明的童鞋请自行Google，我不告诉你这个参数。git commit命令执行成功后会告诉你，1个文件被改动（我们新添加的readme.txt文件），插入了两行内容（readme.txt有两行内容）。<br>为什么Git添加文件需要add，commit一共两步呢？因为commit可以一次提交很多文件，所以你可以多次add不同的文件，比如：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git add file1.txt</div><div class="line">$ git add file2.txt file3.txt</div><div class="line">$ git commit -m <span class="string">"add 3 files."</span></div></pre></td></tr></table></figure>
<h3 id="时光机穿梭"><a href="#时光机穿梭" class="headerlink" title="时光机穿梭"></a>时光机穿梭</h3><blockquote>
<p>现在我改动readme.txt里的内容，就是增加了一排字<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>.hello</div><div class="line"><span class="number">2</span>.git</div><div class="line"><span class="number">3</span>.swust</div></pre></td></tr></table></figure></p>
<p>现在，运行git status命令看看结果：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ git status</div><div class="line">On branch master</div><div class="line">Changes not staged <span class="keyword">for</span> commit:</div><div class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</div><div class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes in working directory)</div><div class="line"></div><div class="line">        modified:   readme.<span class="function">txt</span></div><div class="line"></div><div class="line">no changes added to <span class="title">commit</span> <span class="params">(use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span></div></pre></td></tr></table></figure></p>
<p>git status命令可以让我们时刻掌握仓库当前的状态，上面的命令告诉我们，readme.txt被修改过了，但还没有准备提交的修改,虽然Git告诉我们readme.txt被修改了，但如果能看看具体修改了什么内容，自然是很好的。比如你休假两周从国外回来，第一天上班时，已经记不清上次怎么修改的readme.txt，所以，需要用git diff这个命令看看：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ git diff readme.txt</div><div class="line">diff --git a/readme.txt b/readme.txt</div><div class="line">index bc3cf98..<span class="number">4</span>a9596a <span class="number">100644</span></div><div class="line">--- a/readme.txt</div><div class="line">+++ b/readme.txt</div><div class="line">@@ -<span class="number">1</span>,<span class="number">2</span> +<span class="number">1</span>,<span class="number">3</span> @@</div><div class="line"> <span class="number">1</span>.hello</div><div class="line">-<span class="number">2</span>.git</div><div class="line">\ No newline at end of file</div><div class="line">+<span class="number">2</span>.git</div><div class="line">+<span class="number">3</span>.swust</div><div class="line">\ No newline at end of file</div></pre></td></tr></table></figure>
<blockquote>
<p>git diff就是查看difference,显示的格式正是Unix通用的diff格式，可以从上面的命令输出看到，修改了2.git和增加了3.swust，知道了对readme.txt做了什么修改后，再把它提交到仓库就放心多了，提交修改和提交新文件是一样的两步，第一步是git add，同样没有任何输出，再执行第二步git commit之前，我们再运行git status看看当前仓库的状态：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ git status</div><div class="line">On branch master</div><div class="line">Changes to be committed:</div><div class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</div><div class="line"></div><div class="line">        modified:   readme.txt</div></pre></td></tr></table></figure></p>
<p>git status 告诉我们，将要被提交的修改包括readme.txt，下一步，就可以放心的提交了：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git commit -m <span class="string">"add 3.swust"</span></div><div class="line">[master b1b20a2] add <span class="number">3</span>.swust</div><div class="line"> <span class="number">1</span> file changed, <span class="number">2</span> insertions(+), <span class="number">1</span> deletion(-)</div></pre></td></tr></table></figure></p>
<p>提交后，我们再用git status命令查看仓库的当前状态：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git status</div><div class="line">On branch master</div><div class="line">nothing to commit, working directory clean</div></pre></td></tr></table></figure></p>
<p>git 告诉我们当前没有需要提交的修改，而且，工作目录是干净（working directory clean）的</p>
<p>小结：</p>
<ul>
<li><strong><em>要随时掌握工作区的状态，使用git status命令。</em></strong></li>
<li><strong><em>如果git status告诉你有文件被修改过，用git diff可以查看修改内容。</em></strong></li>
</ul>
</blockquote>
<h3 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h3><blockquote>
<p>现在，把ream.txt里的内容改为,练习一遍提交<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Git is a distributed version control system.</div><div class="line">Git is free software distributed under the GPL.</div></pre></td></tr></table></figure></p>
<p>像这样，你不断对文件进行修改，然后不断提交修改到版本库里，就好比玩RPG游戏时，每通过一关就会自动把游戏状态存盘，如果某一关没过去，你还可以选择读取前一关的状态。有些时候，在打Boss之前，你会手动存盘，以便万一打Boss失败了，可以从最近的地方重新开始。Git也是一样，每当你觉得文件修改到一定程度的时候，就可以“保存一个快照”，这个快照在Git中被称为commit。一旦你把文件改乱了，或者误删了文件，还可以从最近的一个commit恢复，然后继续工作，而不是把几个月的工作成果全部丢失。<br>当然了，在实际工作中，我们脑子里怎么可能记得一个几千行的文件每次都改了什么内容，不然要版本控制系统干什么。版本控制系统肯定有某个命令可以告诉我们历史记录，在Git中，我们用git log命令查看：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ git log</div><div class="line">commit dcc026ea340637919cf088247f3eb675d1ab58e9</div><div class="line">Author: 王家兴 &lt;<span class="number">15883162175</span>@<span class="number">163</span>.com&gt;</div><div class="line">Date:   Fri Mar <span class="number">17</span> <span class="number">11</span>:<span class="number">19</span>:<span class="number">01</span> <span class="number">2017</span> +<span class="number">0800</span></div><div class="line"></div><div class="line">    change content</div><div class="line"></div><div class="line">commit b1b20a29a9568558ea689102cd023efddc712057</div><div class="line">Author: 王家兴 &lt;<span class="number">15883162175</span>@<span class="number">163</span>.com&gt;</div><div class="line">Date:   Fri Mar <span class="number">17</span> <span class="number">11</span>:<span class="number">10</span>:<span class="number">24</span> <span class="number">2017</span> +<span class="number">0800</span></div><div class="line"></div><div class="line">    add <span class="number">3</span>.swust</div><div class="line"></div><div class="line">commit <span class="number">8</span>b5a6a35cc6c45388fcc8cfa7f89015b57548049</div><div class="line">Author: 王家兴 &lt;<span class="number">15883162175</span>@<span class="number">163</span>.com&gt;</div><div class="line">Date:   Fri Mar <span class="number">17</span> <span class="number">10</span>:<span class="number">53</span>:<span class="number">16</span> <span class="number">2017</span> +<span class="number">0800</span></div><div class="line"></div><div class="line">    wrote a readme file</div></pre></td></tr></table></figure>
<blockquote>
<p>git log命令显示从最近到最远的提交日志，我们可以看到3次提交,如果嫌输出信息太多，看得眼花缭乱的，可以试试加上–pretty=oneline参数：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git log --pretty=oneline</div><div class="line">dcc026ea340637919cf088247f3eb675d1ab58e9 change content</div><div class="line">b1b20a29a9568558ea689102cd023efddc712057 add <span class="number">3</span>.swust</div><div class="line"><span class="number">8</span>b5a6a35cc6c45388fcc8cfa7f89015b57548049 wrote a readme file</div></pre></td></tr></table></figure>
<blockquote>
<p>需要友情提示的是，你看到的一大串类似3628164…882e1e0的是commit id（版本号），和SVN不一样，Git的commit id不是1，2，3……递增的数字，而是一个SHA1计算出来的一个非常大的数字，用十六进制表示，而且你看到的commit id和我的肯定不一样，以你自己的为准。为什么commit id需要用这么一大串数字表示呢？因为Git是分布式的版本控制系统，后面我们还要研究多人在同一个版本库里工作，如果大家都用1，2，3……作为版本号，那肯定就冲突了。<br>每提交一个新版本，实际上Git就会把它们自动串成一条时间线。如果使用可视化工具查看Git历史，就可以更清楚地看到提交历史的时间线：</p>
</blockquote>
<p>回退操作</p>
<blockquote>
<p>首先，Git必须知道当前版本是哪个版本，在Git中，用HEAD表示当前版本，也就是最新的提交dcc026ea340637919cf088247f3eb675d1ab58e9（注意我的提交ID和你的肯定不一样），上一个版本就是HEAD^，上上一个版本就是HEAD^^，当然往上100个版本写100个^比较容易数不过来，所以写成HEAD~100。</p>
<ul>
<li><strong><em>git reset –hard HEAD^ </em></strong>    回退上一版本</li>
<li><strong><em>git reset –hard [commit id]</em></strong> 重置到指定版本</li>
<li><strong><em>git log </em></strong>  可以查看所有commit id</li>
<li><strong><em> git reflog</em></strong> 已回退到以前的版本，当你关掉了电脑，第二天早上想恢复到新版本时，可以用这个命令找你要的commit id</li>
</ul>
</blockquote>
<p>小结：</p>
<blockquote>
<ul>
<li>HEAD指向的版本就是当前版本，因此，Git允许我们在版本的历史之间穿梭，使用命令git reset –hard commit_id。</li>
<li>穿梭前，用git log可以查看提交历史，以便确定要回退到哪个版本。</li>
<li>要重返未来，用git reflog查看命令历史，以便确定要回到未来的哪个版本。</li>
</ul>
</blockquote>
<h1 id="工作区和暂存区"><a href="#工作区和暂存区" class="headerlink" title="工作区和暂存区"></a>工作区和暂存区</h1><blockquote>
<p>Git和其他版本控制系统如SVN的一个不同之处就是有暂存区的概念。</p>
<ul>
<li><strong><em>工作区（Working Directory）</em></strong>就是你在电脑里能看到的目录，比如我的HelloGit文件夹就是一个工作区</li>
<li>.<strong><em>版本库（Repository）</em></strong>工作区有一个隐藏目录.git，这个不算工作区，而是Git的版本库。Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区，还有Git为我们自动创建的第一个分支master，以及指向master的一个指针叫HEAD。</li>
</ul>
</blockquote>
<p><img src="http://www.liaoxuefeng.com/files/attachments/001384907702917346729e9afbf4127b6dfbae9207af016000/0" alt=""></p>
<blockquote>
<p>前面讲了我们把文件往Git版本库里添加的时候，是分两步执行的：</p>
<ul>
<li>第一步是用git add把文件添加进去，实际上就是把文件修改添加到暂存区；</li>
<li>第二步是用git commit提交更改，实际上就是把暂存区的所有内容提交到当前分支。</li>
</ul>
<p>因为我们创建Git版本库时，Git自动为我们创建了唯一一个master分支，所以，现在，git commit就是往master分支上提交更改。你可以简单理解为，需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改。</p>
</blockquote>
<h3 id="管理修改"><a href="#管理修改" class="headerlink" title="管理修改"></a>管理修改</h3><blockquote>
<p>第一次修改 -&gt; git add -&gt; 第二次修改 -&gt; git add -&gt; git commit</p>
</blockquote>
<h3 id="撤销修改"><a href="#撤销修改" class="headerlink" title="撤销修改"></a>撤销修改</h3><blockquote>
<p>git checkout – file可以丢弃工作区的修改：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git checkout -- readme.txt</div></pre></td></tr></table></figure>
<blockquote>
<p>命令git checkout – readme.txt意思就是，把readme.txt文件在工作区的修改全部撤销，这里有两种情况：</p>
<ul>
<li>一种是readme.txt自修改后还没有被放到暂存区，现在，撤销修改就回到和版本库一模一样的状态；</li>
<li>一种是readme.txt已经添加到暂存区后，又作了修改，现在，撤销修改就回到添加到暂存区后的状态。</li>
</ul>
</blockquote>
<p><img src="http://github.liaoxuefeng.com/sinaweibopy/video/discard-changes-of-working-dir.mp4" alt=""></p>
<blockquote>
<p>只是修改后并且Git add到暂存区，还没有提交时，撤销修改：<br>用命令<strong><em>git reset HEAD file可以把暂存区的修改撤销掉（unstage）</em></strong>，重新放回工作区：<br>git reset命令既可以回退版本，也可以把暂存区的修改回退到工作区。当我们用HEAD时，表示最新的版本。</p>
<p>-场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令git checkout – file。</p>
<ul>
<li>场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令git reset HEAD file，就回到了场景1，第二步按场景1操作。</li>
<li>场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考版本回退一节，不过前提是没有推送到远程库</li>
</ul>
</blockquote>
<h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><blockquote>
<p>在Git中，删除也是一个修改操作，我们实战一下，先添加一个新文件test.txt到Git并且提交.然后直接在文件管理器把test.txt删了，然后git status命令会立刻告诉你哪些文件被删除了，现在你有两个选择</p>
<ul>
<li>一是确实要从版本库中删除文件，那就用命令git rm file删掉，然后git commit 提交删除修改。</li>
<li>二是删错了，因为版本库里还有，所以可以很轻松地把误删的文件恢复的最新版本。git checkout – file <strong><em>git checkout其实是用版本库里的版本替换工作区的版本，无论工作区是修改还是删除，都可以“一键还原”。</em></strong></li>
</ul>
</blockquote>
<h3 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h3><blockquote>
<p><strong><em>第1步</em></strong>：创建SSH Key。在用户主目录下，看看有没有.ssh目录，如果有，再看看这个目录下有没有id_rsa和id_rsa.pub这两个文件，如果已经有了，可直接跳到下一步。如果没有，打开Shell（Windows下打开Git Bash），创建SSH Key：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh-keygen -t rsa -C <span class="string">"youremail@example.com"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>你需要把邮件地址换成你自己的邮件地址，然后一路回车，使用默认值即可，由于这个Key也不是用于军事目的，所以也无需设置密码。如果一切顺利的话，可以在用户主目录里找到.ssh目录，里面有id_rsa和id_rsa.pub两个文件，这两个就是SSH Key的秘钥对，id_rsa是私钥，不能泄露出去，id_rsa.pub是公钥，可以放心地告诉任何人。<br><strong><em>第二步</em></strong> 登陆GitHub，打开“Account settings”，“SSH Keys”页面,然后，点“Add SSH Key”，填上任意Title，在Key文本框里粘贴id_rsa.pub文件的内容</p>
</blockquote>
<h3 id="添加远程库"><a href="#添加远程库" class="headerlink" title="添加远程库"></a>添加远程库</h3><blockquote>
<p>现在的情景是，你已经在本地创建了一个Git仓库后，又想在GitHub创建一个Git仓库，并且让这两个仓库进行远程同步，这样，GitHub上的仓库既可以作为备份，又可以让其他人通过该仓库来协作，真是一举多得。</p>
<ul>
<li>首先，登陆GitHub，然后，在右上角找到“Create a new repo”按钮，创建一个新的仓库：<br><img src="http://www.liaoxuefeng.com/files/attachments/0013849084639042e9b7d8d927140dba47c13e76fe5f0d6000/0" alt=""></li>
<li>在Repository name填入HelloGit，其他保持默认设置，点击“Create repository”按钮，就成功地创建了一个新的Git仓库：<br><img src="http://www.liaoxuefeng.com/files/attachments/0013849084720379a3eae576b9f417da2add578c8612a2e000/0" alt=""></li>
</ul>
<p>目前，在GitHub上的这个HelloGit仓库还是空的，GitHub告诉我们，可以从这个仓库克隆出新的仓库，也可以把一个已有的本地仓库与之关联，然后，把本地仓库的内容推送到GitHub仓库。</p>
<ul>
<li>要关联一个远程库，使用命令git remote add origin git@server-name:path/repo-name.git；</li>
<li>关联后，使用命令git push -u origin master第一次推送master分支的所有内容；</li>
<li>此后，每次本地提交后，只要有必要，就可以使用命令git push origin master推送最新修改；</li>
<li>分布式版本系统的最大好处之一是在本地工作完全不需要考虑远程库的存在，也就是有没有联网都可以正常工作，而SVN在没有联网的时候是拒绝干活的！当有网络的时候，再把本地提交推送一下就完成了同步，真是太方便了！</li>
</ul>
</blockquote>
<p>###　从远程库克隆</p>
<blockquote>
<ul>
<li>要克隆一个仓库，首先必须知道仓库的地址，然后使用git clone命令克隆。例：git clone git@github.com:michaelliao/gitskills.git 。如果有多个人协作开发，那么每个人各自从远程克隆一份就可以了。</li>
<li>Git支持多种协议，包括https，但通过ssh支持的原生git协议速度最快。</li>
</ul>
</blockquote>
<h3 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h3><h5 id="创建与合并分支"><a href="#创建与合并分支" class="headerlink" title="创建与合并分支"></a>创建与合并分支</h5><blockquote>
<p>在版本回退里，你已经知道，每次提交，Git都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即master分支。HEAD严格来说不是指向提交，而是指向master，master才是指向提交的，所以，HEAD指向的就是当前分支。<br>一开始的时候，master分支是一条线，Git用master指向最新的提交，再用HEAD指向master，就能确定当前分支，以及当前分支的提交点：<br><img src="http://www.liaoxuefeng.com/files/attachments/0013849087937492135fbf4bbd24dfcbc18349a8a59d36d000/0" alt=""></p>
<p>每次提交，master分支都会向前移动一步，这样，随着你不断提交，master分支的线也越来越长.<br>当我们创建新的分支，例如dev时，Git新建了一个指针叫dev，指向master相同的提交，再把HEAD指向dev，就表示当前分支在dev上.<br><img src="http://www.liaoxuefeng.com/files/attachments/001384908811773187a597e2d844eefb11f5cf5d56135ca000/0" alt=""></p>
<p>你看，Git创建一个分支很快，因为除了增加一个dev指针，改改HEAD的指向，工作区的文件都没有任何变化！不过，从现在开始，对工作区的修改和提交就是针对dev分支了，比如新提交一次后，dev指针往前移动一步，而master指针不变.<br>假如我们在dev上的工作完成了，就可以把dev合并到master上。Git怎么合并呢？最简单的方法，就是直接把master指向dev的当前提交，就完成了合并：</p>
</blockquote>
<p><img src="http://www.liaoxuefeng.com/files/attachments/00138490883510324231a837e5d4aee844d3e4692ba50f5000/0" alt=""></p>
<blockquote>
<p>所以Git合并分支也很快！就改改指针，工作区内容也不变！合并完分支后，甚至可以删除dev分支。删除dev分支就是把dev指针给删掉，删掉后，我们就剩下了一条master分支</p>
<ul>
<li>Git鼓励大量使用分支：</li>
<li>查看分支：git branch</li>
<li>创建分支：git branch <name></name></li>
<li>切换分支：git checkout <name></name></li>
<li>创建+切换分支：git checkout -b <name></name></li>
<li>合并某分支到当前分支：git merge <name></name></li>
<li>删除分支：git branch -d <name></name></li>
</ul>
</blockquote>
<h4 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h4><blockquote>
<p>如果master 和其它分支有冲突，则不能合并分支成功。</p>
</blockquote>
<p><img src="http://www.liaoxuefeng.com/files/attachments/001384909115478645b93e2b5ae4dc78da049a0d1704a41000/0" alt=""></p>
<blockquote>
<p>他会提示哪个文件内容有冲突，必须手动解决冲突后再提交，git status也可以告诉我们冲突的文件，Git用&lt;&lt;&lt;&lt;&lt;&lt;&lt;，=======，&gt;&gt;&gt;&gt;&gt;&gt;&gt;标记出不同分支的内容，我们处理好冲突后保存再提交即可解决冲突</p>
</blockquote>
<p><img src="http://www.liaoxuefeng.com/files/attachments/00138490913052149c4b2cd9702422aa387ac024943921b000/0" alt=""></p>
<blockquote>
<p>所以 <strong><em>当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。用git log –graph命令可以看到分支合并图。</em></strong></p>
</blockquote>
<h3 id="分支管理策略"><a href="#分支管理策略" class="headerlink" title="分支管理策略"></a>分支管理策略</h3><blockquote>
<p>通常，合并分支时，如果可能，Git会用Fast forward模式，但这种模式下，删除分支后，会丢掉分支信息。如果要强制禁用Fast forward模式，Git就会在merge时生成一个新的commit，这样，从分支历史上就可以看出分支信息。</p>
<p><strong><em>准备合并dev分支，请注意–no-ff参数，表示禁用Fast forward：</em></strong></p>
<ul>
<li>git merge –no-ff -m “merge with no-ff” dev<br>因为本次合并要创建一个新的commit，所以加上-m参数，把commit描述写进去。</li>
</ul>
</blockquote>
<p><img src="http://www.liaoxuefeng.com/files/attachments/001384909222841acf964ec9e6a4629a35a7a30588281bb000/0" alt=""></p>
<blockquote>
<p>Git分支十分强大，在团队开发中应该充分应用。合并分支时，加上–no-ff参数就可以用普通模式合并，合并后的历史有分支，能看出来曾经做过合并，而fast forward合并就看不出来曾经做过合并。</p>
</blockquote>
<h4 id="Bug分支"><a href="#Bug分支" class="headerlink" title="Bug分支"></a>Bug分支</h4><blockquote>
<ul>
<li>修复bug时，我们会通过创建新的bug分支进行修复，然后合并，最后删除；</li>
<li>当手头工作没有完成时，先把工作现场git stash一下，然后去修复bug，修复后，再git stash pop，回到工作现场。</li>
</ul>
</blockquote>
<p>####　feature分支</p>
<blockquote>
<p>-开发一个新feature，最好新建一个分支；</p>
<ul>
<li>如果要丢弃一个没有被合并过的分支，可以通过git branch -D <name>强行删除。</name></li>
</ul>
</blockquote>
<h4 id="tag标签"><a href="#tag标签" class="headerlink" title="tag标签"></a>tag标签</h4><blockquote>
<ul>
<li>命令git tag <name>用于新建一个标签，默认为HEAD，也可以指定一个commit id</name></li>
<li>git tag -a <tagname> -m “blablabla…”可以指定标签信息</tagname></li>
<li>git tag -s <tagname> -m “blablabla…”可以用PGP签名标签</tagname></li>
<li>命令git tag可以查看所有标签<br>-命令git push origin <tagname>可以推送一个本地标签；<br>-命令git push origin –tags可以推送全部未推送过的本地标签；<br>-命令git tag -d <tagname>可以删除一个本地标签；</tagname></tagname></li>
<li>命令git push origin :refs/tags/<tagname>可以删除一个远程标签。</tagname></li>
</ul>
</blockquote>
<h4 id="使用Github"><a href="#使用Github" class="headerlink" title="使用Github"></a>使用Github</h4><blockquote>
<ul>
<li>在GitHub上，可以任意Fork开源仓库；</li>
<li>自己拥有Fork后的仓库的读写权限；</li>
<li>可以推送pull request给官方仓库来贡献代码。</li>
</ul>
</blockquote>
<h4 id="忽略设置"><a href="#忽略设置" class="headerlink" title="忽略设置"></a>忽略设置</h4><blockquote>
<ul>
<li>忽略某些文件时，需要编写.gitignore</li>
<li>.gitignore文件本身要放到版本库里，并且可以对.gitignore做版本管理！</li>
</ul>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/15/《java核心技术卷一》第四章 对象与类/">
                《java核心技术卷一》第四章
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-15</span>
            
            
                <a href="http://yoursite.com/2017/03/15/《java核心技术卷一》第四章 对象与类/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/《java核心技术卷一》/">《java核心技术卷一》</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p>#《java核心技术卷一》第四章 对象与类</p>
<blockquote>
<p><strong>1.对象有三个特性，即行为（behavior）,状态（state）,标识（identity）</strong><br><strong>2.一个对象变量并没有实际包含一个对象，而仅仅是引用一个对象.在java中，任何对象变量的值都是对存贮在另一个地方的一个对象的引用。所以new操作符的返回值是一个引用。</strong><br><strong>3.final实例域，可以将实例域定义为final，构建对象时必须初始化这样的域，也就是说，必须在一个构造器执行之后，这个域的值被设置，后面的步骤不能够再对它更改。</strong><br> <strong>4.静态域属于类，而不属于任何独立的对象。</strong><br><strong>静态方法是一种不能向独对象实施操作的方法，但是它可以访问自身类中的静态域。</strong><br><strong>5.工厂方法：静态方法的一种应用：不利用构造器就可以实例化一个对象</strong><br><strong>6.方法参数：java语言总是采用按值调用，也就是说，方法得到的是所有参数值的一个拷贝。即<em>一个方法不能修改一个基本数据类型的参数；一个方法可以改变一个对象参数的状态；一个方法不能让对象参数引用一个新的对象</em>。</strong><br><strong>7.如果多个方法（比如构造器方法）有相同的名字，不同的参数，便产生了重载。</strong><br><strong>8.默认域初始化：如果在构造器中没有显示地给域赋予初值，那么就会被自动地赋值给默认值：数值为0，布尔值为false,对象引用为null。  </strong><br><strong>9.参数名可以设置为在参数前面加a,  </strong><br>例   public Employee(String aName,double aSalary)<br><strong>10.可以用this调用另一个构造器。  </strong><br><strong>11.初始化数据域的方法：在构造器中设置值：在声明中赋值；初始化块  </strong><br><strong>12.java有自动的垃圾回收期，不需要人工回收内存，所以java不支持析构器。 </strong><br><strong>13.静态导入：import不仅可以导入类，还增加了导入静态方法和静态域的功能：  </strong><br>例： 使用import static java.lang.System.<em> 就可以使用System类的静态方法和静态域，而不必加类名前缀*</em></p>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/15/《java核心技术卷一》第三章 java的基本程序设计结构/">
                《java核心技术卷一》第三章
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-15</span>
            
            
                <a href="http://yoursite.com/2017/03/15/《java核心技术卷一》第三章 java的基本程序设计结构/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/《java核心技术卷一》/">《java核心技术卷一》</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p>#《java核心技术卷一》第三章 java的基本程序设计结构</p>
<p>##<strong>注释</strong><br>1.使用//<br>2.长篇注释用/<em>和<strong>/<br>3.用来自动生成文档，以/</strong>开始，以</em>/结束</p>
<p>##<strong>数据类型</strong><br>java是一种强类型语言，意味着必须为每一个变量声明一种类型，一共有8种基本类型<br><img src="http://ojgs96t5i.bkt.clouddn.com/java基本数据结构.png" alt="image">  </p>
<p>###<strong>整型</strong>   </p>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小</th>
<th>数值范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>int</td>
<td>4字节</td>
<td>-2147483648-2147483647</td>
</tr>
<tr>
<td>short</td>
<td>2字节</td>
<td>-323768-32767</td>
</tr>
<tr>
<td>long</td>
<td>8字节</td>
<td>-92233720368547758008-9223372036854775807</td>
</tr>
<tr>
<td>byte</td>
<td>1字节</td>
<td>-128-127</td>
</tr>
</tbody>
</table>
<p>java7开始，加上前缀0b就可以写二进制数比如9为0b1001;另外可以为数字字面量加下划线，例用1_000_000（或0b1111_0100_0010_0100_0000）表示一百万  </p>
<p>###<strong>浮点类型</strong>   </p>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小</th>
<th>范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>float</td>
<td>4字节</td>
<td>有效位6~7位</td>
</tr>
<tr>
<td>double</td>
<td>8字节</td>
<td>有效位为15位</td>
</tr>
</tbody>
</table>
<p>float类型的数值有一个后缀F,没有后缀F的浮点数值默认为double类型，当然也可以在后面添加后缀D</p>
<p>浮点数值计算遵循IEEE754规范，表示溢出或出错情况的三个特殊的浮点数值：<br>1.正无穷大<br>2.负无穷大<br>3.NaN(不是一个数字)（用Double&gt;isNaN（x）检测一个特定值是否等于Double&gt;NaN）  </p>
<p>###<strong>char类型</strong><br>Unicode编码单元可以表示为十六进制值，范围从\u0000到\Uffff  </p>
<p>弄清char类型，就必须了解Unicode编码表。在Unicode出现之前，已经有许多不同的标准：美国的ASC||,西欧语言的ISO8859-1，俄国的KOI-8，中国的GB 18030和BIG-5等  </p>
<p><strong>代码点</strong>：指与一个编码表中的某个字符对应的代码值<br><strong>代码单元</strong>：每个字符用16位表示，通常被称为代码单元<br>在java中，char类型用UTF-16编码描述一个代码单元  </p>
<p>###<strong>boolean类型</strong><br>false和true。整型值和布尔值之间不能进行相互转换。</p>
<p>##<strong>变量</strong>  </p>
<p>##<strong>常量</strong><br>利用关键字final表示常量，只能被赋值一次，习惯常量名全部大写  </p>
<p>##<strong>运算符</strong>  </p>
<pre><code class="~">
###**数学函数与常量**  
Math类中，包含了各种各样的数学函数，还提供两个用于表示π和e常量的近似值：  
Math.PI  
Math.E  
###**数值类型之间的转换**  
![image](http://ojgs96t5i.bkt.clouddn.com/数据类型转换.png)  
图中有6个实心箭头，表示无信息丢失的转换；有3个虚箭头，表示可能有精度损失的转换。  
&gt;int n=12345678;     
&gt;float f=n;//f is 1.23456792E8     

使用上面两个数值进行二元操作时，先要将两个操作数转换为同一种类型，然后再计算。  
*  如果两个操作数中有一个是double类型，另一个操作数就会转换为double类型。  
*  否则，如果其中一个操作数是float类型，另一个操作数将会转换为float类型。  
*  否则，如果其中一个操作数是long类型，另一个操作数将会转换为long类型。   
*  否则，两个操作数都将被转换为int类型。   
###**强制类型转换**  
这种转换可能会丢失一些信息   
例  
&gt;double x=9,997;  
int nx=(int)x;  

这样，变量nx的值为9，强制类型转换通过小数部分将浮点值转换为整型。如果想对浮点数进行舍入运算，那就需要使用Math.round方法。 
&gt;double x=9.997;  
int nx=(int)Math.round(x);  

现在，变量nx的值为10，注意，round方法返回的结果为long类型，所以还需要使用（int）  
###**枚举类型**  
有时候，变量的取值只在一个有限的集合内。例如：服装
尺寸可用S,M,L,X表示。为了防止变量保存错误的值，可以自定义枚举类型。枚举类型包括有限个命名的值。例如：   
&gt;enum Size {SMALL,MEDIUM,LARGE,EXTRA_LARGE};   
&gt;Size s=Size.SMALL;  

Size类型的变量智能存贮这个类型声明中给定的某个枚举值，或者null值。  
###**字符串**  
标准java类库中提供了一个预定义类，很自然地叫做String，每个用双引号括起来的字符串都是String的一个实例。  
####**子串**  
String类的substring方法可提取一个字串，***从第一个位置计数，直到最后个位置参数，但不包括最后一个位置对应的字符。***  
####**拼接**  
允许使用+符号连接两个字符串。  
####**不可变字符串**  
String类没有提供用于修改字符串的方法，但可以用拼接方法实现。  
####**检测字符串是否相等**  
使用equals方法检测两个字符串是否相等。检测是否相等而不区分大小写使用equalsIgnoreCase方法**一定不能使用==运算符检测两个字符串是否相等，这个运算符只能够确定两个字符串是否放置在同一个位置上。如果字符串放置在同一个位置上，他们必然相等，但是，完全有可能将内容相同的多个字符串的拷贝放置在不同的位置上**  
####**空串与null串**  
空串&quot;&quot;是长度为0的字符串。可以调用  
if(str.length()==0)或if(str.equals(&quot;&quot;))。String变量还可以存放一个特殊的值，名为null,表示目前没有任何对象与该变量关联，可用if（str==null）检测  
####**构建字符串**  
如果使用许多小段的字符串构建一个字符串，那么可以用字符串构建器。例：  
&gt;StringBuilder builder=new StringBuilder();   
builder.append(ch);//追加一个字符  
builder.append(str);//追加一字符串  
String comleteString=builder.toString();  

###**输入输出**
</code></pre>
<p>###<strong>控制流程</strong>  </p>
<p>####<strong>块作用域</strong>  </p>
<p>####<strong>条件语句</strong>  </p>
<p>####<strong>循环</strong>  </p>
<p>####<strong>确定循环:for</strong>  </p>
<p>####<strong>多重选择：switch</strong>  </p>
<p>####<strong>中断控制流程语句</strong>  </p>
<p>###<strong>大数值</strong>  </p>
<p>###<strong>数组</strong>  </p>
<blockquote>
<p>int[] a=new int[100];  </p>
</blockquote>
<p>####<strong>for each循环</strong>    </p>
<blockquote>
<p>for(pariable:collection) statement  //循环collection中的每一个元素    </p>
</blockquote>
<p>####<strong>数组初始化以及匿名数组</strong>  </p>
<blockquote>
<p>int[] a={1,2,3,4,5};<br>new int[]{1,2,3,4,5};      </p>
</blockquote>
<p>####<strong>数组拷贝</strong><br>允许将一个数组变量拷贝给另一个数组变量，这时，两个变量将引用同一个数组。  </p>
<p>####<strong>数组排序</strong><br>可用Arrays类中的sort方法：使用了优化的快速排序算法。  </p>
<p>####<strong>多维数组</strong>  </p>
<p>####<strong>不规则数组</strong></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/15/《java核心技术卷一》第五章 继承/">
                《java核心技术卷一》第五章
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-15</span>
            
            
                <a href="http://yoursite.com/2017/03/15/《java核心技术卷一》第五章 继承/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/《java核心技术卷一》/">《java核心技术卷一》</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p>#《java核心技术卷一》第五章 继承</p>
<p>####<strong>1.关键字extends表明正在构造的新类派生于一个已存在的类，已存在的类称为超类，基类或父类；新类称为子类，派生类或孩子类。</strong>  </p>
<p>####<strong>2.设计类的时候，应该将通用的方法放在超类中，将具有特殊用途的方法放在子类中。</strong>  </p>
<p>####<strong>3.子类的方法不能直接访问超类的私有域，如果一定要访问，必须借助共有的接口，如果超类接口方法名与子类相同，在方法名前加super.</strong>  </p>
<p>####<strong>4.在子类中可以增加域，增加方法或覆盖超类的方法，然而绝对不能删除继承的任何域和方法，java中使用关键字super调用超类的方法。</strong>  </p>
<p>####<strong>5.由于子类的构造器不能访问超类的私有域，所以必须利用超类的构造器对这部分私有域进行初始化，我们可以通过super实现对超类构造器的调用。而使用super调用构造器的语句必须是子类构造器的第一条语句。</strong>  </p>
<p>####<strong>6.如果子类的构造器没有显示地调地调用超类的构造器，则自动地调用超类默认（没有参数）的构造器，如果超类没有不带参数的构造器，并且在子类的构造器中有没有显示地调用超类的其他构造器，则java编译器将报告错误。</strong>  </p>
<p>####<strong>7.java不支持多继承</strong>  </p>
<p>####<strong>8.超类变量可以引用任何一个它的子类对象。</strong>  </p>
<p>####<strong>9.强制转换只能在继承层次内进行；在将超类转换为子类之前，应该使用instanceof进行检查。</strong>  </p>
<p>####<strong>10.超类的方法使用abstract，这样就可以完全不需要实这个方法了.为了提高程序的清晰度，包含一个或多个抽象方法的类本身必须被声明为抽象的。</strong><br>例：  &gt;public abstract String getDescription();  </p>
<p>####<strong>11.受保护访问：</strong><br>| 关键字 | 功能 |<br>|–|–|<br>| public | 对所有类可见 |<br>| private | 仅对本类可见 |<br>| protected | 对本包和所有子类可见 |<br>| 默认 | 对本包可见 |   </p>
<p>####<strong>12.Object：所有类的超类,它有hashcode,equals,toString方法</strong>  </p>
<p>####<strong>13.泛型数组列表，可以动态地改变数组大小，可用ArrayList泛型类，可用toArray方法将数组元素拷贝到一个数组中。</strong>  </p>
<p>####<strong>14.对象包装器与自动装箱：将基本类型转换为对象的这种类叫包装类，例ArrayList<integer> list=new ArrayList&lt;&gt;()   list.add(3);将自动地变换为list.add(Integer.value(3));</integer></strong>  </p>
<p>####<strong>15.参数可变方法：</strong><br>例：&gt;public static double max(double… values)<br>{<br>    double largest = Double.MINVALUE;<br>for(double v:values){<br>if(v&gt;largest) largest=v;<br>}<br>return largest;<br>}</p>
<p>####<strong>……..</strong>    </p>
<hr>
<p>参考书籍《java核心技术 卷一》</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/15/android Splash界面及全屏视频欢迎界面实现/">
                android Splash界面及全屏视频欢迎界面实现
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-15</span>
            
            
                <a href="http://yoursite.com/2017/03/15/android Splash界面及全屏视频欢迎界面实现/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/android界面/">android界面</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="android-Splash界面及全屏视频欢迎界面实现"><a href="#android-Splash界面及全屏视频欢迎界面实现" class="headerlink" title="android Splash界面及全屏视频欢迎界面实现"></a>android Splash界面及全屏视频欢迎界面实现</h1><h3 id="Splash界面"><a href="#Splash界面" class="headerlink" title="Splash界面"></a>Splash界面</h3><blockquote>
<p>引用启动时会最先加载window,window的背景是可以在style里设置的，默认的windowBackground是白色的，一旦应用很大，初始化操作很多，应用冷启动时就会出现白屏很久，体验效果就不是很好，所以可以把windowBackground换为自己的背景，实现Splash,谷歌的Youtube貌似就是这样的。</p>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><h4 id="定义SplashTheme"><a href="#定义SplashTheme" class="headerlink" title="定义SplashTheme"></a>定义SplashTheme</h4><p>windowBackground 只能放drawable资源<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"SpashTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.NoActionBar"</span>&gt;</span><span class="xml"></span></div><div class="line">      <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@drawable/splash<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="定义SplashActivity"><a href="#定义SplashActivity" class="headerlink" title="定义SplashActivity"></a>定义SplashActivity</h4><blockquote>
<p>在onCreate里直接写跳转，不用setContentView,所以不用审么布局文件xml那些，也不用渲染什么控件，直接跳转，节省资源。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">       Intent intent=<span class="keyword">new</span> Intent(<span class="keyword">this</span>,WelcomeActivity.class);</div><div class="line">       startActivity(intent);</div><div class="line">       finish();</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><p><img src="http://ojgs96t5i.bkt.clouddn.com/splashActivity.gif" alt="效果图"></p>
<h3 id="视频欢迎界面"><a href="#视频欢迎界面" class="headerlink" title="视频欢迎界面"></a>视频欢迎界面</h3><h4 id="定义CustomVideoView"><a href="#定义CustomVideoView" class="headerlink" title="定义CustomVideoView"></a>定义CustomVideoView</h4><blockquote>
<p>因为默认的VideoView是根据实际视频显示大小的，即使设置了match-parent,也不一定见效</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 当前类注释:自定义VideoView 实现全屏播放</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomVideoView</span> <span class="keyword">extends</span> <span class="title">VideoView</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomVideoView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomVideoView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomVideoView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="comment">//设置全屏</span></div><div class="line">        <span class="keyword">int</span> width = getDefaultSize(<span class="number">0</span>, widthMeasureSpec);</div><div class="line">        <span class="keyword">int</span> height = getDefaultSize(<span class="number">0</span>, heightMeasureSpec);</div><div class="line">        setMeasuredDimension(width, height);</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnPreparedListener</span><span class="params">(MediaPlayer.OnPreparedListener l)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.setOnPreparedListener(l);</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onKeyDown(keyCode, event);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="定义welcomeActivity界面布局"><a href="#定义welcomeActivity界面布局" class="headerlink" title="定义welcomeActivity界面布局"></a>定义welcomeActivity界面布局</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"com.newtrekwang.kenews.Ui.WelcomeActivity"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">com.newtrekwang.kenews.Widgt.CustomVideoView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/welcome_videoview"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span></div><div class="line">        <span class="attr">android:clickable</span>=<span class="string">"false"</span></div><div class="line">        <span class="attr">android:focusable</span>=<span class="string">"false"</span></div><div class="line">        <span class="attr">android:focusableInTouchMode</span>=<span class="string">"false"</span></div><div class="line">        /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/welcome_button"</span></div><div class="line">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"30dp"</span></div><div class="line">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"进入KeNews"</span></div><div class="line">        <span class="attr">android:textSize</span>=<span class="string">"16sp"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"@color/color_white"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"150dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"40dp"</span></div><div class="line">        /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="定义WelcomeActivity"><a href="#定义WelcomeActivity" class="headerlink" title="定义WelcomeActivity"></a>定义WelcomeActivity</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WelcomeActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@BindView</span>(R.id.welcome_videoview)</div><div class="line">    CustomVideoView welcome_videoview;</div><div class="line">    <span class="meta">@BindView</span>(R.id.welcome_button)</div><div class="line">    Button welcome_button;</div><div class="line">    <span class="keyword">private</span> Unbinder unbinder;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_welcome);</div><div class="line"><span class="comment">//        绑定控件</span></div><div class="line">        unbinder = ButterKnife.bind(<span class="keyword">this</span>);</div><div class="line"><span class="comment">//         设置播放源,播放的是一个MP4文件，放在raw里，这里用的是36kr的视频</span></div><div class="line">        welcome_videoview.setVideoURI(Uri.parse(<span class="string">"android.resource://"</span> + <span class="keyword">this</span>.getPackageName() + <span class="string">"/"</span> + R.raw.kr36));</div><div class="line">        welcome_videoview.start();</div><div class="line"><span class="comment">//        设置重复播放</span></div><div class="line">        welcome_videoview.setOnCompletionListener(<span class="keyword">new</span> MediaPlayer.OnCompletionListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</div><div class="line">                welcome_videoview.start();</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 跳转按钮点击事件，点击后，先确保停止播放，再跳转</div><div class="line">     */</div><div class="line">    <span class="meta">@OnClick</span>(R.id.welcome_button)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (welcome_videoview.isPlaying()) &#123;</div><div class="line">            welcome_videoview.stopPlayback();</div><div class="line">            welcome_videoview = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</div><div class="line">        startActivity(intent);</div><div class="line">        finish();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * home键点击事件处理</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onBackPressed();</div><div class="line">        <span class="keyword">if</span> (welcome_videoview.isPlaying()) &#123;</div><div class="line">            welcome_videoview.stopPlayback();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 解绑控件</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        <span class="keyword">if</span> (unbinder != <span class="keyword">null</span>) &#123;</div><div class="line">            unbinder.unbind();</div><div class="line">            unbinder = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="效果-1"><a href="#效果-1" class="headerlink" title="效果"></a>效果</h4><p><img src="http://ojgs96t5i.bkt.clouddn.com/welcomeActivity.gif" alt=""></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/08/rxjava 使用总结（基本篇）/">
                rxjava 使用总结（基本篇）
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-08</span>
            
            
                <a href="http://yoursite.com/2017/03/08/rxjava 使用总结（基本篇）/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/rxjava/">rxjava</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="rxjava-使用总结（基本篇）"><a href="#rxjava-使用总结（基本篇）" class="headerlink" title="rxjava 使用总结（基本篇）"></a>rxjava 使用总结（基本篇）</h1><h3 id="站在巨人的肩膀上"><a href="#站在巨人的肩膀上" class="headerlink" title="站在巨人的肩膀上"></a>站在巨人的肩膀上</h3><blockquote>
<ul>
<li>扔物线写的，就是从他的文章第一次接触rxjava的 <a href="https://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="external">https://gank.io/post/560e15be2dca930e00da1083</a></li>
<li><a href="https://gold.xitu.io/user/573dba2171cfe448aa97b7b0" target="_blank" rel="external">https://gold.xitu.io/user/573dba2171cfe448aa97b7b0</a>   这个系列的也写得不错，通俗易懂，循序渐进，而且介绍的是最新的rxjava2。<strong>本笔记内容大多也是出自上述博客的内容</strong></li>
</ul>
</blockquote>
<h3 id="rxjava-是什么"><a href="#rxjava-是什么" class="headerlink" title="rxjava 是什么"></a>rxjava 是什么</h3><blockquote>
<p><strong>定义</strong>：a library for composing asynchronous and event-based programs using observable sequences for the Java VM”（一个在 Java VM 上使用可观测的序列来组成异步的、基于事件的程序的库）<br><strong>优势：</strong>随着程序逻辑变得越来越复杂，它依然能够保持简洁。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h5 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h5><p>这里我直接用扔物线的图<br><img src="http://ww3.sinaimg.cn/mw1024/52eb2279jw1f2rx4ay0hrg20ig08wk4q.gif" alt=""></p>
</blockquote>
<h4 id="普通使用"><a href="#普通使用" class="headerlink" title="普通使用"></a>普通使用</h4><blockquote>
<p>构造被观察者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Observable&lt;Integer&gt; observable=Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">         <span class="comment">//这里的e专门发射事件，当发射过onComplete()，</span></div><div class="line">            <span class="comment">// 观察者接收到后，观察者将不会再接收事件</span></div><div class="line">            e.onNext(<span class="number">1</span>);</div><div class="line">            e.onNext(<span class="number">2</span>);</div><div class="line">            e.onNext(<span class="number">3</span>);</div><div class="line">            e.onNext(<span class="number">4</span>);</div><div class="line">            e.onNext(<span class="number">5</span>);</div><div class="line">            e.onComplete();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>构造观察者</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Observer&lt;Integer&gt; observer=<span class="keyword">new</span> Observer&lt;Integer&gt;() &#123;</div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</div><div class="line">              <span class="comment">//我暂时看作订阅开始，这个方法会被首先调用,这里就可以引用Disposable了，便于管理订阅</span></div><div class="line">                  logOut(String.valueOf(d.isDisposed()));</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Integer value)</span> </span>&#123;</div><div class="line">              <span class="comment">//接收到事件</span></div><div class="line">                  logOut(value.toString());</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">              <span class="comment">//接收到error事件</span></div><div class="line">          &#125;</div><div class="line"></div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</div><div class="line">              <span class="comment">//接收到onComplete事件</span></div><div class="line">                  logOut(<span class="string">"onComplete"</span>);</div><div class="line">          &#125;</div><div class="line">      &#125;;</div></pre></td></tr></table></figure>
<blockquote>
<p>确定订阅关系</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">observable.subscribe(observer);</div></pre></td></tr></table></figure>
<blockquote>
<p>结果</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">false</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">5</span></div><div class="line">onComplete</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong></p>
<ul>
<li>上游可以发送无限个onNext, 下游也可以接收无限个onNext.</li>
<li>当上游发送了一个onComplete后, 上游onComplete之后的事件将会继续发送, 而下游收到onComplete事件之后将不再继续接收事件.</li>
<li>当上游发送了一个onError后, 上游onError之后的事件将继续发送, 而下游收到onError事件之后将不再继续接收事件.</li>
<li>上游可以不发送onComplete或onError.</li>
<li>最为关键的是onComplete和onError必须唯一并且互斥, 即不能发多个onComplete, 也不能发多个onError, 也不能先发一个onComplete, 然后再发一个onError, 反之亦然</li>
<li>Disposable, 这个单词的字面意思是一次性用品,用完即可丢弃的. 那么在RxJava中怎么去理解它呢, 对应于上面的水管的例子, 我们可以把它理解成两根管道之间的一个机关, 当调用它的dispose()方法时, 它就会将两根管道切断, 从而导致下游收不到事件.<strong>调用dispose()并不会导致上游不再继续发送事件, 上游会继续发送剩余的事件.</strong></li>
<li>不带任何参数的subscribe() 表示下游不关心任何事件,你上游尽管发你的数据去吧, 老子可不管你发什么.</li>
<li>带有一个Consumer参数的方法表示下游只关心onNext事件, 其他的事件假装没看见, 因此我们如果只需要onNext事件可以用Consumer</li>
</ul>
</blockquote>
<h4 id="线程调度"><a href="#线程调度" class="headerlink" title="线程调度"></a>线程调度</h4><blockquote>
<ul>
<li>subscribeOn() 指定的是上游发送事件的线程, observeOn() 指定的是下游接收事件的线程.</li>
<li>多次指定上游的线程只有第一次指定的有效, 也就是说多次调用subscribeOn() 只有第一次的有效, 其余的会被忽略.</li>
<li>多次指定下游的线程是可以的, 也就是说每调用一次observeOn() , 下游的线程就会切换一次每次切换都可以获取结果（doOnNext()）.</li>
<li>Schedulers.io() 代表io操作的线程, 通常用于网络,读写文件等io密集型的操作</li>
<li>Schedulers.computation() 代表CPU计算密集型的操作, 例如需要大量计算的操作</li>
<li>Schedulers.newThread() 代表一个常规的新线程</li>
<li>AndroidSchedulers.mainThread() 代表Android的主线程</li>
<li><strong>RxJava中已经内置了一个容器CompositeDisposable, 每当我们得到一个Disposable时就调用CompositeDisposable.add()将它添加到容器中, 在退出的时候, 调用CompositeDisposable.clear() 即可切断所有的水管.</strong><h5 id="变换"><a href="#变换" class="headerlink" title="变换"></a>变换</h5>所谓变换，就是将事件序列中的对象或整个序列进行加工处理，转换成不同的事件或事件序列<h5 id="map"><a href="#map" class="headerlink" title="map()"></a>map()</h5>变换操作符，作用是对上游发送的每一个时间都应用一个函数，使得每一个事件都按照指定的函数去变化。<br>例：把上面的例子改下，实现变换<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"> observable.map(<span class="keyword">new</span> Function&lt;Integer, String&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">            <span class="comment">//这里把integer变换为String</span></div><div class="line">                <span class="keyword">return</span> <span class="string">"trans to :"</span>+integer.toString();</div><div class="line">            &#125;</div><div class="line">        &#125;).subscribe(observer);</div><div class="line"><span class="comment">//相应的观察者observer肯定是接收的String</span></div><div class="line"></div><div class="line"> Observer&lt;String&gt; observer=<span class="keyword">new</span> Observer&lt;String&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</div><div class="line">                <span class="comment">//我暂时看作订阅开始，这个方法会被首先调用</span></div><div class="line">                    logOut(String.valueOf(d.isDisposed()));</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String value)</span> </span>&#123;</div><div class="line">                <span class="comment">//接收到事件</span></div><div class="line">                    logOut(value);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">                <span class="comment">//接收到error事件</span></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="comment">//接收到onComplete事件</span></div><div class="line">                    logOut(<span class="string">"onComplete"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h4 id="FlatMap"><a href="#FlatMap" class="headerlink" title="FlatMap"></a>FlatMap</h4><blockquote>
<p>FlatMap将一个发送事件的上游Observable变换为多个发送事件的Observables，然后将它们发射的事件合并后放进一个单独的Observable里.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">observable.flatMap(<span class="keyword">new</span> Function&lt;Integer, ObservableSource&lt;String&gt;&gt;() &#123;</div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> ObservableSource&lt;String&gt; <span class="title">apply</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">               ArrayList&lt;String&gt; list=<span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;integer;i++)&#123;</div><div class="line">                   list.add(<span class="string">"my value is:"</span>+integer);</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">return</span> Observable.fromIterable(list);</div><div class="line">           &#125;</div><div class="line">       &#125;).subscribe(observer);</div></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">false</span></div><div class="line">my value is:<span class="number">1</span></div><div class="line">my value is:<span class="number">2</span></div><div class="line">my value is:<span class="number">2</span></div><div class="line">my value is:<span class="number">3</span></div><div class="line">my value is:<span class="number">3</span></div><div class="line">my value is:<span class="number">3</span></div><div class="line">my value is:<span class="number">4</span></div><div class="line">my value is:<span class="number">4</span></div><div class="line">my value is:<span class="number">4</span></div><div class="line">my value is:<span class="number">4</span></div><div class="line">my value is:<span class="number">5</span></div><div class="line">my value is:<span class="number">5</span></div><div class="line">my value is:<span class="number">5</span></div><div class="line">my value is:<span class="number">5</span></div><div class="line">my value is:<span class="number">5</span></div><div class="line">onComplete</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>这里需要注意的是, flatMap并不保证事件的顺序</strong>，要保证顺序的话则需要使用concatMap</p>
<h4 id="map-flatpmap应用"><a href="#map-flatpmap应用" class="headerlink" title="map,flatpmap应用"></a>map,flatpmap应用</h4><p>利用flatmap操作符，可以优雅的解决嵌套请求问题，只需要flatmap转换一下就行了。</p>
</blockquote>
<p>比如实现注册后就立即登录<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">api.register(<span class="keyword">new</span> RegisterRequest())            <span class="comment">//发起注册请求</span></div><div class="line">                .subscribeOn(Schedulers.io())               <span class="comment">//在IO线程进行网络请求</span></div><div class="line">                .observeOn(AndroidSchedulers.mainThread())  <span class="comment">//回到主线程去处理请求注册结果</span></div><div class="line">                .doOnNext(<span class="keyword">new</span> Consumer&lt;RegisterResponse&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(RegisterResponse registerResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="comment">//先根据注册的响应结果去做一些操作</span></div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .observeOn(Schedulers.io())                 <span class="comment">//回到IO线程去发起登录请求</span></div><div class="line">                .flatMap(<span class="keyword">new</span> Function&lt;RegisterResponse, ObservableSource&lt;LoginResponse&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> ObservableSource&lt;LoginResponse&gt; <span class="title">apply</span><span class="params">(RegisterResponse registerResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="keyword">return</span> api.login(<span class="keyword">new</span> LoginRequest());</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())  <span class="comment">//回到主线程去处理请求登录的结果</span></div><div class="line">                .subscribe(<span class="keyword">new</span> Consumer&lt;LoginResponse&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(LoginResponse loginResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"登录成功"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">                    &#125;</div><div class="line">                &#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"登录失败"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>简直是行云流水一样有木有！</strong></p>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/08/rxjava 应用扩展/">
                rxjava 应用扩展
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-08</span>
            
            
                <a href="http://yoursite.com/2017/03/08/rxjava 应用扩展/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/rxjava/">rxjava</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="rxjava-应用扩展"><a href="#rxjava-应用扩展" class="headerlink" title="rxjava 应用扩展"></a>rxjava 应用扩展</h1><h3 id="倒计时"><a href="#倒计时" class="headerlink" title="倒计时"></a>倒计时</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="keyword">import</span> io.reactivex.Observable;</div><div class="line"><span class="keyword">import</span> io.reactivex.Observer;</div><div class="line"><span class="keyword">import</span> io.reactivex.android.schedulers.AndroidSchedulers;</div><div class="line"><span class="keyword">import</span> io.reactivex.disposables.Disposable;</div><div class="line"><span class="keyword">import</span> io.reactivex.functions.Function;</div><div class="line"><span class="keyword">import</span> io.reactivex.schedulers.Schedulers;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Button button_start, button_stop;</div><div class="line">    <span class="keyword">private</span> Disposable disposable;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MainActivity&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        button_start = (Button) findViewById(R.id.appCompatButton);</div><div class="line">        button_stop = (Button) findViewById(R.id.button_stop);</div><div class="line">        button_start.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        button_stop.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 开始倒计时</div><div class="line"> */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startCountDown</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">long</span> count = <span class="number">10</span>;</div><div class="line"><span class="comment">//        第一个参数是发射事件的延时时间，第二个是两次发射事件的间隔时间，第三个是时间单位（这里是秒）</span></div><div class="line">        Observable.interval(<span class="number">0</span>, <span class="number">1</span>, TimeUnit.SECONDS)</div><div class="line">                .take((<span class="keyword">int</span>) count)</div><div class="line">                .map(<span class="keyword">new</span> Function&lt;Long, Long&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Long <span class="title">apply</span><span class="params">(Long aLong)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="keyword">return</span> count - aLong;</div><div class="line">                    &#125;</div><div class="line">                &#125;).subscribeOn(Schedulers.computation())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(<span class="keyword">new</span> Observer&lt;Long&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</div><div class="line">                        button_start.setClickable(<span class="keyword">false</span>);</div><div class="line">                        disposable = d;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Long value)</span> </span>&#123;</div><div class="line"><span class="comment">//                        设置按钮数字</span></div><div class="line">                        button_start.setText(value.toString());</div><div class="line">                        Log.i(TAG, <span class="string">"onNext: &gt;&gt;&gt;&gt;&gt;&gt;"</span> + value);</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">                        Log.e(TAG, <span class="string">"onError: "</span> + e.getMessage());</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">//                        结束后</span></div><div class="line">                        button_start.setClickable(<span class="keyword">true</span>);</div><div class="line">                        button_start.setText(<span class="string">"start"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (view.getId()) &#123;</div><div class="line">            <span class="keyword">case</span> R.id.appCompatButton:</div><div class="line"><span class="comment">//                开始倒计时</span></div><div class="line">                startCountDown();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.button_stop:</div><div class="line"><span class="comment">//                结束倒计时</span></div><div class="line">                <span class="keyword">if</span> (disposable != <span class="keyword">null</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (!disposable.isDisposed()) &#123;</div><div class="line">                        disposable.dispose();</div><div class="line">                        button_start.setClickable(<span class="keyword">true</span>);</div><div class="line">                        button_start.setText(<span class="string">"start"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>效果：</p>
</blockquote>
<p><img src="http://ojgs96t5i.bkt.clouddn.com/rxjava_countdown.gif" alt="效果图"></p>
<blockquote>
<p>实际项目中，经常在注册，修改密码，忘记密码获取验证吗时需要用到这个，注意当计时正在发生时，遇到要取消计时或界面销毁前要记得取消订阅</p>
</blockquote>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="disabled" href="/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/2/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2017/04/05/排序/">java实现基础算法</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/03/25/android IPC机制实现方式之AIDL/">android IPC机制实现方式之AIDL</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/03/25/android四大组件之Service/">android四大组件之Service</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/03/20/git学习笔记/">git学习笔记</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/Git/">Git</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/AIDL/">AIDL</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/android界面/">android界面</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/android四大组件/">android四大组件</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/Wangjiaxing123/">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/u/0/104493906013014839335">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'newtrek';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>