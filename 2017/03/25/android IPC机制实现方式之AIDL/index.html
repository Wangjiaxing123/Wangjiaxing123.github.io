<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="一念起，天涯咫尺；一念灭，咫尺天涯。">
    

    <!--Author-->
    
        <meta name="author" content="newtrekWang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="android IPC机制实现方式之AIDL"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="一念起，天涯咫尺；一念灭，咫尺天涯。" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="生命在于折腾"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>android IPC机制实现方式之AIDL - 生命在于折腾</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2017/03/25/android IPC机制实现方式之AIDL/">
                android IPC机制实现方式之AIDL
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-25</span>
            
            
                <a href="#disqus_thread" class="comments">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/AIDL/">AIDL</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h1 id="android-IPC机制实现方式之AIDL"><a href="#android-IPC机制实现方式之AIDL" class="headerlink" title="android IPC机制实现方式之AIDL"></a>android IPC机制实现方式之AIDL</h1><h3 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h3><blockquote>
<p>进程间通信或者跨进程通信，是指链各个进程之间进行数据交互的过程。</p>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><p>是CPU调度的最小丹云，同时线程是一种有限的资源；</p>
<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><p>是指一个执行单元，在PC和移动设备上是指一个程序或者一个应用，一个进程可以包含多个进程，因此进程和线程是包含和被包含的关系。</p>
<h2 id="IPC的使用场景"><a href="#IPC的使用场景" class="headerlink" title="IPC的使用场景"></a>IPC的使用场景</h2><p><strong>只有面对多进程时，才需要考虑进程间通信，多进程的情况分为两种：</strong></p>
<ul>
<li>.一个应用因为某些原因自身需要采用多进程模式来实现，比如：有些模块需要运行在单独的进程中，又或者是为了增大一个应用可使用的内存所以需要多进程来获取多份内存空间。</li>
<li>一个应用需要向其它应用获取数据，由于是两个应用，所以必须采用跨进程的方式来获取所需的数据，比如：通过ContentProvider对通讯录的增删改查。</li>
</ul>
</blockquote>
<a id="more"></a>
<h2 id="android中的多进程模式"><a href="#android中的多进程模式" class="headerlink" title="android中的多进程模式"></a>android中的多进程模式</h2><blockquote>
<ul>
<li>Android中的多进程是指一个应用中存在多个进程的，在Android中使用多进程的方法有且只有一种：就是给四大组件（Activity,Service,Receiver,ContentProvider)，在AndroidManifest中指定android:process属性,Android默认进程名是包名。</li>
<li>process属性的定义分为两种<ul>
<li>android:process=”com.xxx.xxxx.remote” 完整的命名方式，属于全局进程，其它应用通过ShareUID方式可以和它跑在同一个进程中。<ul>
<li>android:process=”:remote”，进程以“:”开头的进程属于当前应用的私有进程，其它应用的组件不可以和它跑在同一个进程中，“:”命名的进程会在当前的进程名之前附加上包名如：“com.xxx.xxxx:remote”。</li>
</ul>
</li>
</ul>
</li>
<li>UID：Android系统会为每个应用分配一个唯一的UID，具有相同UID的应用才能共享数据。如果两个应用通过ShareUID跑在同一个进程中，需要两个应用具有相同的shareUID并且相同的签名才可以。</li>
<li>多进程带来的问题<ul>
<li>.静态成员和单例模式完全失效</li>
<li>线程同步机制完全失效</li>
<li>SharePreference的可靠性下降</li>
<li>Application会多次创建</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="跨进程通信的方式"><a href="#跨进程通信的方式" class="headerlink" title="跨进程通信的方式"></a>跨进程通信的方式</h3><blockquote>
<ul>
<li>Intent传递数据</li>
<li>文件共享</li>
<li>Messenger</li>
<li>AIDL</li>
<li>ContentProvider</li>
<li>Socker<h3 id="小目标"><a href="#小目标" class="headerlink" title="小目标"></a>小目标</h3></li>
<li>会使用AIDL进行进程间通信</li>
<li>会手写AIDL的编码，加深对Binder机制的理解<h3 id="创建AIDL"><a href="#创建AIDL" class="headerlink" title="创建AIDL"></a>创建AIDL</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// IRemoteService.aidl</span></div><div class="line"><span class="keyword">package</span> com.newtrekwang.practices_sample;</div><div class="line"><span class="keyword">import</span> com.newtrekwang.practices_sample.Mydata;</div><div class="line"><span class="keyword">import</span> com.newtrekwang.practices_sample.IRemoteServiceCallBack;</div><div class="line"></div><div class="line"><span class="comment">// Declare any non-default types here with import statements</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IRemoteService</span> </span>&#123;</div><div class="line"></div><div class="line"> <span class="comment">/** Request the process ID of this service, to do evil things with it. */</span></div><div class="line">     <span class="function"><span class="keyword">int</span> <span class="title">getPid</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">killProcess</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="function">Mydata <span class="title">getData</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">startSomeThings</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">registerCallBack</span><span class="params">(IRemoteServiceCallBack cb)</span></span>;</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">unRegisterCallBack</span><span class="params">(IRemoteServiceCallBack cb)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat,</span></span></div><div class="line">            <span class="keyword">double</span> aDouble, String aString);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>这个接口文件是接口，定义了服务要实现的方法。如果有其它接口的话，也要另外定义并加import导入，服务要传输的对象数据也要另外定义并实现Parcelable接口。</p>
</blockquote>
<p>例：自定义Mydata类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.newtrekwang.practices_sample;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Parcel;</div><div class="line"><span class="keyword">import</span> android.os.Parcelable;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * The type Mydata.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Mydata</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Mydata</span><span class="params">(<span class="keyword">int</span> data1, <span class="keyword">int</span> data2)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data1 = data1;</div><div class="line">        <span class="keyword">this</span>.data2 = data2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Mydata&#123;"</span> +</div><div class="line">                <span class="string">"data1="</span> + data1 +</div><div class="line">                <span class="string">", data2="</span> + data2 +</div><div class="line">                <span class="string">'&#125;'</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> data1;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> data2;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Gets data 1.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> the data 1</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getData1</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets data 1.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> data1 the data 1</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData1</span><span class="params">(<span class="keyword">int</span> data1)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data1 = data1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Gets data 2.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> the data 2</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getData2</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets data 2.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> data2 the data 2</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData2</span><span class="params">(<span class="keyword">int</span> data2)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data2 = data2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Instantiates a new Mydata.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> in the in</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">Mydata</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">        readFromParcel(in);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * The constant CREATOR.</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Creator&lt;Mydata&gt; CREATOR = <span class="keyword">new</span> Creator&lt;Mydata&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Mydata <span class="title">createFromParcel</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Mydata(in);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="keyword">public</span> Mydata[] newArray(<span class="keyword">int</span> size) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Mydata[size];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 将数据写入到Parcel</div><div class="line">     **/</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel dest, <span class="keyword">int</span> flags)</span> </span>&#123;</div><div class="line">        dest.writeInt(data1);</div><div class="line">        dest.writeInt(data2);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 从Parcel中读取数据</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> in the in</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFromParcel</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">        data1 = in.readInt();</div><div class="line">        data2 = in.readInt();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>定义服务回调接口IRemoteServiceCallBack.aidl，也就是接口方法的实现在activity里<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.newtrekwang.practices_sample;</div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IRemoteServiceCallBack</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">valueChange</span><span class="params">(<span class="keyword">int</span> value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>定义MyData.aidl<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.newtrekwang.practices_sample;</div><div class="line">parcelable Mydata;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>然后AIDL接口定义好后，系统会自动生成对应的XXXService.Stub，感觉应该是Binder的代理，然后在你的Service里实例化一个，实现里面的方法，返回给onBinder();</p>
</blockquote>
<p>定义RemoteService.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"RemoteService&gt;&gt;&gt;&gt;&gt;"</span>;</div><div class="line">    Mydata mydata;</div><div class="line">    <span class="keyword">private</span> NotificationManager mNM;</div><div class="line">    <span class="keyword">private</span> IRemoteServiceCallBack remoteServiceCallback;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"onBind: !!!!!!!!!!"</span> );</div><div class="line">        <span class="keyword">return</span> mBinder;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line"></div><div class="line">        mNM= (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</div><div class="line">        showNotification();</div><div class="line">        Log.e(TAG, <span class="string">"onCreate: !!!!!!!!!!"</span> );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onUnbind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"onUnbind: !!!!!!!!!!!!"</span> );</div><div class="line">        showUnbindNotification();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onUnbind(intent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        mNM.cancel(R.string.hello);</div><div class="line">        Log.e(TAG, <span class="string">"onDestroy: !!!!!!!!!!!!"</span> );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IRemoteService.Stub mBinder=<span class="keyword">new</span> IRemoteService.Stub() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPid</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            <span class="keyword">return</span> Process.myPid();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">killProcess</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            Process.killProcess(Process.myPid());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Mydata <span class="title">getData</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Mydata(<span class="number">2</span>,<span class="number">4</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startSomeThings</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    Thread.sleep(<span class="number">3000</span>);</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">                Log.e(TAG, <span class="string">"startSomeThings: &gt;&gt;&gt;&gt;"</span>+i );</div><div class="line">                remoteServiceCallback.valueChange(i);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerCallBack</span><span class="params">(IRemoteServiceCallBack cb)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            remoteServiceCallback=cb;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unRegisterCallBack</span><span class="params">(IRemoteServiceCallBack cb)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            remoteServiceCallback=<span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat, <span class="keyword">double</span> aDouble, String aString)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showNotification</span><span class="params">()</span></span>&#123;</div><div class="line">        PendingIntent contentIntent=PendingIntent.getActivity(<span class="keyword">this</span>,<span class="number">0</span>, <span class="keyword">new</span> Intent(<span class="keyword">this</span>,Notification.class),<span class="number">0</span>);</div><div class="line">        Notification.Builder builder=<span class="keyword">new</span> Notification.Builder(<span class="keyword">this</span>);</div><div class="line">        builder.setSmallIcon(R.mipmap.ic_launcher)</div><div class="line">                .setTicker(<span class="string">"the service has start!"</span>)</div><div class="line">                .setContentIntent(contentIntent)</div><div class="line">                .setContentTitle(<span class="string">"RemoteService"</span>)</div><div class="line">                .setContentText(<span class="string">"点击后打开一个Activity！"</span>)</div><div class="line">                .setWhen(System.currentTimeMillis());</div><div class="line">        Notification noti=builder.build();</div><div class="line">        mNM.notify(R.string.hello,noti);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showUnbindNotification</span><span class="params">()</span></span>&#123;</div><div class="line">        Notification.Builder builder=<span class="keyword">new</span> Notification.Builder(<span class="keyword">this</span>);</div><div class="line">        builder.setSmallIcon(R.mipmap.ic_launcher)</div><div class="line">                .setTicker(<span class="string">"the service unBind"</span>)</div><div class="line">                .setContentTitle(<span class="string">"RemoteService"</span>)</div><div class="line">                .setContentText(<span class="string">"！"</span>)</div><div class="line">                .setWhen(System.currentTimeMillis());</div><div class="line">        Notification noti=builder.build();</div><div class="line">        mNM.notify(R.string.hello,noti);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在activity里请求绑定<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">    <span class="keyword">private</span> ServiceConnection mConnection=<span class="keyword">new</span> ServiceConnection() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</div><div class="line">            Log.e(TAG, <span class="string">"onServiceConnected: !!!!!!!!!!"</span> );</div><div class="line"><span class="comment">//            这里的IRemoteService.Stub.asInterface是关键，获取到了那个代理，以后想用服务</span></div><div class="line"><span class="comment">//            就找这个代理做事。</span></div><div class="line">            mService =IRemoteService.Stub.asInterface(service);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line"><span class="comment">//                注册回调</span></div><div class="line">                mService.registerCallBack(iRemoteServiceCallBack);</div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            mBound=<span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</div><div class="line">            Log.e(TAG, <span class="string">"onServiceDisconnected: !!!!!!!!!"</span> );</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line"><span class="comment">//                取消回调</span></div><div class="line">                mService.unRegisterCallBack(iRemoteServiceCallBack);</div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            mBound=<span class="keyword">false</span>;</div><div class="line">            mService=<span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line"><span class="comment">//                绑定服务</span></div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, RemoteService.class);</div><div class="line">                bindService(intent,mConnection,BIND_AUTO_CREATE);</div><div class="line"></div><div class="line"><span class="comment">//                解除绑定</span></div><div class="line">                <span class="keyword">if</span> (mBound)&#123;</div><div class="line">                    unbindService(mConnection);</div><div class="line">                &#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//                与服务绑定后，打印服务远程发来的数据</span></div><div class="line">                <span class="keyword">if</span> (mBound) &#123;</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                       Mydata mdata=mService.getData();</div><div class="line">                        Log.e(TAG, <span class="string">"onClick: &gt;&gt;&gt;&gt;"</span>+mdata.toString() );</div><div class="line">                    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>经结果验证，服务和activity的所在的进程是不同的，</p>
</blockquote>
<p><img src="http://ojgs96t5i.bkt.clouddn.com/QQ20170325173924.jpg" alt=""></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><blockquote>
<p>没怎么用Service，也不知道那些情况最好用跨进程的Service<br>不过看了下郭霖大神的博客，貌似有了些了解：</p>
<p><strong>不要把后台和子线程联系在一起就行了，这是两个完全不同的概念。Android的后台就是指，它的运行是完全不依赖UI的。即使Activity被销毁，或者程序被关闭，只要进程还在，Service就可以继续运行。比如说一些应用程序，始终需要与服务器之间始终保持着心跳连接，就可以使用Service来实现。你可能又会问，前面不是刚刚验证过Service是运行在主线程里的么？在这里一直执行着心跳连接，难道就不会阻塞主线程的运行吗？当然会，但是我们可以在Service中再创建一个子线程，然后在这里去处理耗时逻辑就没问题了。既然在Service里也要创建一个子线程，那为什么不直接在Activity里创建呢？这是因为Activity很难对Thread进行控制，当Activity被销毁之后，就没有任何其它的办法可以再重新获取到之前创建的子线程的实例。而且在一个Activity中创建的子线程，另一个Activity无法对其进行操作。但是Service就不同了，所有的Activity都可以与Service进行关联，然后可以很方便地操作其中的方法，即使Activity被销毁了，之后只要重新与Service建立关联，就又能够获取到原有的Service中Binder的实例。因此，使用Service来处理后台任务，Activity就可以放心地finish，完全不需要担心无法对后台任务进行控制的情况。</strong></p>
<p>那既然远程Service这么好用，干脆以后我们把所有的Service都转换成远程Service吧，还省得再开启线程了。其实不然，远程Service非但不好用，甚至可以称得上是较为难用。一般情况下如果可以不使用远程Service，就尽量不要使用它。</p>
</blockquote>

    </div>

    

    

    <!-- Comments -->
    
    <div class="comments">
        
<div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>



    </div>
    

</div>
        </section>

    </div>
</div>

</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2017/04/22/基本概念/">HTTP总结</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/04/22/什么是注解/">编译时注解</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/04/20/线性表概念/">线性表</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/04/20/JetBrains C++ IDE CLion配置/">Clion 安装</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/androidDialog/">androidDialog</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/c/">c++</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/SQLite/">SQLite</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/android面试/">android面试</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/Wangjiaxing123/">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/u/0/104493906013014839335">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'newtrek';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>