<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="一念起，天涯咫尺；一念灭，咫尺天涯。">
    

    <!--Author-->
    
        <meta name="author" content="newtrekWang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="生命在于折腾"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="一念起，天涯咫尺；一念灭，咫尺天涯。" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="生命在于折腾"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>page - 生命在于折腾</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">生命在于折腾</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/04/《android 源码设计模式》笔记之代理模式/">
                Untitled
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-04</span>
            
            
                <a href="http://yoursite.com/2017/03/04/《android 源码设计模式》笔记之代理模式/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
        </div>
    </div>

    
        <div class="content">
            <p>#《android 源码设计模式》笔记之代理模式</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>为其它对象提供一种以控制对这个对象的访问</p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当无法或不想直接访问某个对象或访问某个对象存在困难时可以通过一个代理对象来间接来访问，为了保证客户端使用的透明性，委托对象与代理对象需要事项相同的接口。</p>
<h2 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h2><ul>
<li>Client —客户类<br>即使用代理类的类型</li>
<li>Subject— 抽象主题类<br>主要职责是声明真实主题与代理的共同接口关系，该类既可以是一个抽象类也可以是一个接口。</li>
<li>RealSubject — 实现抽象主题的真是主题类<br>被委托类或被代理类，定义了代理所表示的真是对象，由其执行具体的业务逻辑方法，而客户端则通过代理类间接地调用真实主题类中定义的方法。</li>
<li>ProxySubject — 代理类（持有真实主题的引用）<br>委托类或代理类，持有对真实主题类的引用。</li>
</ul>
</blockquote>
<p><img src="http://ojgs96t5i.bkt.clouddn.com/QQ20170304112232.jpg" alt=""></p>
<h2 id="实现："><a href="#实现：" class="headerlink" title="实现："></a>实现：</h2><blockquote>
<p>小明被老板拖欠工资，小明选择了走发法律途径解决该纠纷。所以小明请律师作为自己的诉讼代理人。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * </div><div class="line"> * <span class="doctag">@author</span> newtrekwang</div><div class="line"> * <span class="doctag">@desc</span> 代理接口 </div><div class="line"> * 2017年3月4日</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ILawSuit</span> </span>&#123;</div><div class="line"><span class="comment">//	提交申请</span></div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">submit</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">//		进行举证</span></div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">burden</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">//		开始辩护</span></div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">defend</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">//		诉讼完成</span></div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * </div><div class="line"> * <span class="doctag">@author</span> newtrekwang</div><div class="line"> * <span class="doctag">@desc</span> 被代理者小明 </div><div class="line"> * 2017年3月4日</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XiaoMin</span>  <span class="keyword">implements</span> <span class="title">ILawSuit</span></span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">//小明申请仲裁</span></div><div class="line">		System.out.println(<span class="string">"老板拖欠工资，特此申请仲裁!"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">burden</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"这是合同书和过去一年的银行工资流水"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">defend</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"证据确凿，不需要再说什么了"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"诉讼成功！判决老板即日起七天内结算工资！"</span>);</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * </div><div class="line"> * <span class="doctag">@author</span> newtrekwang</div><div class="line"> * <span class="doctag">@desc</span>  代理律师</div><div class="line"> * 2017年3月4日</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lawyer</span> <span class="keyword">implements</span> <span class="title">ILawSuit</span> </span>&#123;</div><div class="line"><span class="comment">//	持有一个具体被代理者的引用</span></div><div class="line">	<span class="keyword">private</span> ILawSuit mLawSuit;</div><div class="line">	</div><div class="line">	 <span class="function"><span class="keyword">public</span> <span class="title">Lawyer</span><span class="params">(ILawSuit iLawSuit)</span> </span>&#123;</div><div class="line">		 <span class="keyword">this</span>.mLawSuit=iLawSuit;</div><div class="line">	 &#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">()</span> </span>&#123;</div><div class="line">		mLawSuit.submit();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">burden</span><span class="params">()</span> </span>&#123;</div><div class="line">		mLawSuit.burden();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">defend</span><span class="params">()</span> </span>&#123;</div><div class="line">		mLawSuit.defend();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span> </span>&#123;</div><div class="line">		mLawSuit.finish();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>客户使用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">	ILawSuit xiaoMin=<span class="keyword">new</span> XiaoMin();</div><div class="line">	Lawyer lawyer=<span class="keyword">new</span> Lawyer(xiaoMin);</div><div class="line">	lawyer.submit();</div><div class="line">	lawyer.burden();</div><div class="line">	lawyer.defend();</div><div class="line">	lawyer.finish();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>结果</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">老板拖欠工资，特此申请仲裁!</div><div class="line">这是合同书和过去一年的银行工资流水</div><div class="line">证据确凿，不需要再说什么了</div><div class="line">诉讼成功！判决老板即日起七天内结算工资！</div></pre></td></tr></table></figure>
<h2 id="静态代理，动态代理"><a href="#静态代理，动态代理" class="headerlink" title="静态代理，动态代理"></a>静态代理，动态代理</h2><blockquote>
<ul>
<li><strong>静态代理 </strong>：静态代理如上述代码一样，代理者的代码由程序员自己或通过一些自动化工具生成固定的代码再对其进行编译，也就是说我们的代码运行前代理类的class编译文件就已存在；</li>
<li><strong>动态代理</strong>：与静态代理相反，通过反射机制动态地生成代理者的对象，也就是说我们在code阶段不知道要代理谁，代理谁我们将会在执行阶段决定。而Java也给我们提供了一个便捷的动态代理接口InvocationHandler，实现该接口需要重写其调用方法invoke.</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxy</span>  <span class="keyword">implements</span> <span class="title">InvocationHandler</span></span>&#123;</div><div class="line">	<span class="keyword">private</span> Object obj;<span class="comment">//被代理的类引用</span></div><div class="line">	</div><div class="line">	 <span class="function"><span class="keyword">public</span> <span class="title">DynamicProxy</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.obj=obj;	</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">		<span class="comment">//调用被代理类对象的方法</span></div><div class="line">		Object result=method.invoke(obj, args);</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>使用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"><span class="comment">//		构造一个小明</span></div><div class="line">		ILawSuit xiaoMin=<span class="keyword">new</span> XiaoMin();</div><div class="line"><span class="comment">//		构造一个动态代理</span></div><div class="line">		DynamicProxy dynamicProxy=<span class="keyword">new</span> DynamicProxy(xiaoMin);</div><div class="line"><span class="comment">//		获取被代理类小明的ClassLoader</span></div><div class="line">		ClassLoader loader=xiaoMin.getClass().getClassLoader();</div><div class="line"><span class="comment">//		动态构造一个代理者律师</span></div><div class="line">		ILawSuit lawyer=(ILawSuit) Proxy.newProxyInstance(loader, <span class="keyword">new</span> Class[]&#123;ILawSuit.class&#125;, dynamicProxy);</div><div class="line">		lawyer.submit();</div><div class="line">		lawyer.burden();</div><div class="line">		lawyer.defend();</div><div class="line">		lawyer.finish();</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>结果</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">老板拖欠工资，特此申请仲裁!</div><div class="line">这是合同书和过去一年的银行工资流水</div><div class="line">证据确凿，不需要再说什么了</div><div class="line">诉讼成功！判决老板即日起七天内结算工资！</div></pre></td></tr></table></figure>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/03/《android 源码设计模式》笔记之原型模式/">
                java 设计模式之原型模式
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-03</span>
            
            
                <a href="http://yoursite.com/2017/03/03/《android 源码设计模式》笔记之原型模式/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/设计模式/">设计模式</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p>#《android 源码设计模式》笔记之原型模式</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>用原型实例指定常见对象的种类，并通过拷贝这些原型创建新的对象。</p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li>类初始化需要消化非常多的资源，这个资源包括数据，硬件资源等，通过原型拷贝避免这些消耗。</li>
<li>通过new产生一个对象需要非常繁琐的数据准备货访问权限，这是可以使用原型模式。</li>
<li>一个对象需要提供给其它调用者访问，而且各个调用者可能都需要修改其值时，可以考虑用原型模式拷贝多个对象共调用者使用，即保护性拷贝。<br>注意，通过实现cloneAble接口的原型模式在调用colone函数构造实例是并不一定比new操作速度快，只有当通过new构造对象较为耗时或者成本较高时，通过clone方法才能够获得效率上的提高。所以，在使用cloneAble时需要考虑构造对象的成本以及做一些效率上的测试。</li>
</ul>
</blockquote>
<h2 id="UML-图"><a href="#UML-图" class="headerlink" title="UML 图"></a>UML 图</h2><blockquote>
<ul>
<li>Client :客户端用户</li>
<li>protocolType： 抽象类或者接口，申明具有clone能力</li>
<li>ConcretePrototype:具体的实现类。</li>
</ul>
</blockquote>
<p> <img src="http://ojgs96t5i.bkt.clouddn.com/QQ20170303212707.jpg" alt=""></p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordDocument</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</div><div class="line">	<span class="comment">//文本</span></div><div class="line">	<span class="keyword">private</span> String mText;</div><div class="line">	<span class="comment">//图片文件名</span></div><div class="line">	<span class="keyword">private</span> ArrayList&lt;String&gt; mImages=<span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">WordDocument</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"-----------WordDocument构造数据------------"</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 克隆对象方法</div><div class="line">	 */</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> WordDocument <span class="title">clone</span><span class="params">()</span> </span>&#123;</div><div class="line">		WordDocument document;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			document = (WordDocument) <span class="keyword">super</span>.clone();</div><div class="line">			document.mText=<span class="keyword">this</span>.mText;</div><div class="line">			document.mImages=<span class="keyword">this</span>.mImages;</div><div class="line">			<span class="keyword">return</span> document;</div><div class="line">		&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.mText;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(String mText)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.mText=mText;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">addImage</span><span class="params">(String img)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.mImages.add(img);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showDocument</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Text :\t"</span>+mText+<span class="string">"Images :\t"</span>+mImages.toString());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>Client使用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">	WordDocument wordDocument=<span class="keyword">new</span> WordDocument();</div><div class="line">	wordDocument.setText(<span class="string">"这是一篇文档！"</span>);</div><div class="line">	wordDocument.addImage(<span class="string">"图片一"</span>);</div><div class="line">	wordDocument.addImage(<span class="string">"图片二"</span>);</div><div class="line">	wordDocument.addImage(<span class="string">"图片三"</span>);</div><div class="line">	wordDocument.addImage(<span class="string">"图片四"</span>);</div><div class="line">	wordDocument.showDocument();</div><div class="line">	<span class="comment">//以原始文档为原型，拷贝一份副本</span></div><div class="line">	WordDocument wordDocument_clone=wordDocument.clone();</div><div class="line">	wordDocument_clone.showDocument();</div><div class="line">	<span class="comment">//修改文档副本，不会影响原始文档</span></div><div class="line">	wordDocument_clone.setText(<span class="string">"这是修改过的Doc2文本"</span>);</div><div class="line">	wordDocument_clone.showDocument();</div><div class="line">	</div><div class="line">	wordDocument.showDocument();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>结果</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-----------WordDocument构造数据------------</div><div class="line">Text :	这是一篇文档！Images :	[图片一, 图片二, 图片三, 图片四]</div><div class="line">Text :	这是一篇文档！Images :	[图片一, 图片二, 图片三, 图片四]</div><div class="line">Text :	这是修改过的Doc2文本Images :	[图片一, 图片二, 图片三, 图片四]</div><div class="line">Text :	这是一篇文档！Images :	[图片一, 图片二, 图片三, 图片四]</div></pre></td></tr></table></figure>
<blockquote>
<p>可得wordDocument_clone是通过wordDocment.clone()创建的，并且wordDocument_clone第一次输出的时候和wordDocment输出是一样的，通过clone对象时并不会执行构造函数！</p>
</blockquote>
<h2 id="深复制与浅复制"><a href="#深复制与浅复制" class="headerlink" title="深复制与浅复制"></a>深复制与浅复制</h2><blockquote>
<p>上述 实例实现的是浅拷贝<br>相关知识：<a href="http://blog.csdn.net/zhangjg_blog/article/details/18369201" target="_blank" rel="external">http://blog.csdn.net/zhangjg_blog/article/details/18369201</a><br>以后再总结</p>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/02/java 设计模式之Builder模式/">
                java 设计模式之Builder模式
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-02</span>
            
            
                <a href="http://yoursite.com/2017/03/02/java 设计模式之Builder模式/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/设计模式/">设计模式</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="java-设计模式之Builder模式"><a href="#java-设计模式之Builder模式" class="headerlink" title="java 设计模式之Builder模式"></a>java 设计模式之Builder模式</h1><blockquote>
<p>本篇内容大部分引自《android源码设计模式》</p>
</blockquote>
<h2 id="模式定义"><a href="#模式定义" class="headerlink" title="模式定义"></a>模式定义</h2><blockquote>
<p>讲一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</p>
</blockquote>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><blockquote>
<ul>
<li>相同的方法，不同的执行顺序，产生不同的事件结果时。</li>
<li>多个部件或零件，都可以装配到一个对象中，但是产生的运行结果又不相同时。</li>
<li>产品类非常复杂，或者产品类中的调用顺序不同产生了不同的作用，这个时候使用建造者模式非常合适。</li>
<li>当初始化一个对象特别复杂，如参数多，且很多参数都具有默认值时。</li>
</ul>
</blockquote>
<h2 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h2><blockquote>
<ul>
<li>Product 产品类—产品的抽象类</li>
<li>Builder —抽象Builder类，规范产品的组建，一般是由子类实现具体的组建过程。</li>
<li>ConcreteBuilder —具体的Builder类</li>
</ul>
</blockquote>
<p><img src="http://ojgs96t5i.bkt.clouddn.com/QQ20170302161229.jpg" alt=""></p>
<h3 id="；例子"><a href="#；例子" class="headerlink" title="；例子"></a>；例子</h3><blockquote>
<p>计算机的组装过程较为负复杂，并且组装顺序是不固定的；</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> </span>&#123;</div><div class="line">	<span class="keyword">protected</span> String mBoard;</div><div class="line">	<span class="keyword">protected</span> String mDisplay;</div><div class="line">	<span class="keyword">protected</span> String mOS;</div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="title">Computer</span><span class="params">()</span></span>&#123;&#125;</div><div class="line"><span class="comment">//设置主板</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBoard</span><span class="params">(String board)</span></span>&#123;</div><div class="line">	<span class="keyword">this</span>.mBoard=board;</div><div class="line">&#125;</div><div class="line"><span class="comment">//设置显示器</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDisplay</span><span class="params">(String display)</span> </span>&#123;</div><div class="line">	mDisplay=display;</div><div class="line">&#125;</div><div class="line"><span class="comment">//设置操作系统</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span>  <span class="title">setOS</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">	StringBuilder stringBuilder=<span class="keyword">new</span> StringBuilder();</div><div class="line">	<span class="keyword">if</span> (mBoard!=<span class="keyword">null</span>) &#123;</div><div class="line">		stringBuilder.append(<span class="string">"myBoard is:"</span>+mBoard);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (mDisplay!=<span class="keyword">null</span>) &#123;</div><div class="line">		stringBuilder.append(<span class="string">"\nmDisplay is:"</span>+mDisplay);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (mOS!=<span class="keyword">null</span>) &#123;</div><div class="line">		stringBuilder.append(<span class="string">"\nmyOS is:"</span>+mOS);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> stringBuilder.toString();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//抽象Builder类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacBook</span>  <span class="keyword">extends</span> <span class="title">Computer</span></span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOS</span><span class="params">()</span> </span>&#123;</div><div class="line">		mOS=<span class="string">"Mac _S X 10.10"</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="comment">//具体的Builder类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacBookBuilder</span> <span class="keyword">extends</span> <span class="title">Buider</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Computer mComputer=<span class="keyword">new</span> MacBook();</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Buider <span class="title">buildBoard</span><span class="params">(String board)</span> </span>&#123;</div><div class="line">		mComputer.setBoard(board);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Buider <span class="title">buildDisplay</span><span class="params">(String display)</span> </span>&#123;</div><div class="line">		mComputer.setDisplay(display);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Buider <span class="title">buildOS</span><span class="params">()</span> </span>&#123;</div><div class="line">		mComputer.setOS();</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Computer <span class="title">create</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> mComputer;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//使用</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		MacBookBuilder macBookBuilder=<span class="keyword">new</span> MacBookBuilder();</div><div class="line">		System.out.println(macBookBuilder.buildBoard(<span class="string">"英特尔主板"</span>)</div><div class="line">		.buildDisplay(<span class="string">"retina"</span>)</div><div class="line">		.buildOS()</div><div class="line">		.create().toString());</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>结果：<br>myBoard is:英特尔主板<br>mDisplay is:retina<br>myOS is:Mac _S X 10.10</p>
</blockquote>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><blockquote>
<p>在android源码中，最常用到的Builder模式就是AlertDialog.Builder,所以根据这个我们可以定义自己的CustomDialog.Buider,CustomPopupWindow.Builder</p>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/01/java 设计模式之单例模式/">
                java 设计模式之单例模式
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-01</span>
            
            
                <a href="http://yoursite.com/2017/03/01/java 设计模式之单例模式/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/设计模式/">设计模式</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="java-设计模式之单例模式"><a href="#java-设计模式之单例模式" class="headerlink" title="java 设计模式之单例模式"></a>java 设计模式之单例模式</h1><blockquote>
<p>单例模式是应用最广的模式之一，单例对象的类必须保证只有一个实例存在。如在一个应用中，应该只有一个ImageLoader实例，这个ImageLoader中又含有线程池，缓存系统，网络请求等，很消耗资源，因此，没有理由让它构造多个实例。<br><strong>定义：</strong>确保一个类只有一个实例，而且自行实例化并向整个系统提供这个实例。<br><strong>角色：</strong></p>
<ul>
<li>Client 高层客户端</li>
<li>Singleton 单例类</li>
</ul>
<p>实现单例模式关键点：</p>
<ul>
<li>构造函数不对外开放，一般为private；</li>
<li>通过一个静态方法或者枚举返回单例类对象；</li>
<li>确保单例类的对象有且只有一个，尤其是在多线程环境下；</li>
<li>确保单例类对象在反序列化时不会重新构建对象；</li>
</ul>
</blockquote>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><h3 id="饿汉模式"><a href="#饿汉模式" class="headerlink" title="饿汉模式"></a>饿汉模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton instance =<span class="keyword">new</span> Singleton();</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> instance;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="懒汉模式"><a href="#懒汉模式" class="headerlink" title="懒汉模式"></a>懒汉模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</div><div class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">if</span> (instance==<span class="keyword">null</span>) &#123;</div><div class="line">			instance=<span class="keyword">new</span> Singleton();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> instance;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>这里getInstance()方法添加了synchronized关键字，也就是getInstance()是一个同步方法，目的是保证在多线程情况下单例对象唯一的手段。这里会有个问题，即使instance已经被初始化，每次调用getInstance()方法都会进行同步，这样会消耗不必要的资源。</p>
</blockquote>
<h3 id="Double-Check-Lock（DCL）实现单例"><a href="#Double-Check-Lock（DCL）实现单例" class="headerlink" title="Double Check Lock（DCL）实现单例"></a>Double Check Lock（DCL）实现单例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton instance=<span class="keyword">null</span>;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">if</span> (instance==<span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">synchronized</span> (Singleton.class)&#123;</div><div class="line">				<span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</div><div class="line">					instance=<span class="keyword">new</span> Singleton();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> instance;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>DCL方式实现单例模式的优点是既能在需要时才初始化单例，又能保证线程安全，且单例对象初始化调用后调用getInstance不进行同步锁。</p>
</blockquote>
<h3 id="静态内部类单例模式"><a href="#静态内部类单例模式" class="headerlink" title="静态内部类单例模式"></a>静态内部类单例模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> SingletonHolder.sInstance;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 静态内部类</div><div class="line">	 */</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span></span>&#123;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton sInstance=<span class="keyword">new</span> Singleton();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>DCL虽然在一定程度上解决了资源消耗，多余的同步，线程安全等问题，但是，他还是在某些情况下出项失效的问题。<br>当第一次加载Singleton类时并不会初始化sInstance,只有在第一次调用Singleton的getInstance方法时才会导致sInstance被初始化。因此，第一次调用getInstance方法会导致虚拟机加载SinglentonHolder类，这种方式不仅能确保线程安全，也能够保证单例对象的唯一性，同时也延迟了单例的实例化，所以这个是推荐使用的单例模式实现方式。</p>
</blockquote>
<h3 id="枚举单例"><a href="#枚举单例" class="headerlink" title="枚举单例"></a>枚举单例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SingletonEnum &#123;</div><div class="line">	INSTANCE;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dosomeThing</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"do sth."</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用容器实现单例模式"><a href="#使用容器实现单例模式" class="headerlink" title="使用容器实现单例模式"></a>使用容器实现单例模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonManager</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,Object&gt; objMap=<span class="keyword">new</span> HashMap&lt;String,Object&gt;();</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="title">SingletonManager</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerService</span><span class="params">(String key,Object instance)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span> (!objMap.containsKey(key)) &#123;</div><div class="line">			objMap.put(key, instance);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getService</span><span class="params">(String key)</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> objMap.get(key);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>在程序的初始，将多种单例类型注入到一个统一的管理类中，在使用时根据key获取对象对应类型的对象。</p>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/03/01/android面试题day1/">
                android面试一天一题 day1
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-03-01</span>
            
            
                <a href="http://yoursite.com/2017/03/01/android面试题day1/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/android面试/">android面试</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <blockquote>
<p>感觉大四还是找工作的概率大，感觉考研没多大吸引力，也许是我没多大概念吧。与其寄希望于考研，不如把握现在。<br>参考一师兄的建议，每天看下面试题，总结衍生android知识框架。</p>
</blockquote>
<h1 id="面试题：知道Service吗，它有几种启动方式？"><a href="#面试题：知道Service吗，它有几种启动方式？" class="headerlink" title="面试题：知道Service吗，它有几种启动方式？"></a>面试题：知道Service吗，它有几种启动方式？</h1><p>原文链接：<a href="http://www.jianshu.com/p/7a7db9f8692d?utm_campaign=haruki&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=qq" target="_blank" rel="external">http://www.jianshu.com/p/7a7db9f8692d?utm_campaign=haruki&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=qq</a></p>
<blockquote>
<p>要我现在回答，我可能说我只知道,它没有界面，运行在后台，一直在处理一些耗时长的任务，比后台播放音乐，一些IM框架也会启动服务。两种启动方式，因为我好像在平时开发中从来没有用过它。既然这里要问，好好补补吧。</p>
</blockquote>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><blockquote>
<p>Service是一个专门在后台处理长时间任务的android组件，它没有UI,一旦Service被启动起来，它就跟Activity一样，它完全具有自己的生命周期。他有两种启动方式，startService和bindService.</p>
<p>扩：开发Service的步骤和开发Activity的步骤很像，开发Service组件需要先开发一个Service子类，然后在AndroidManifest.xml文件中配置该Service，配置时可通过<intent-filter...>元素指定它可被那些intent启动。服务可以处理网络事务、播放音乐，执行文件 I/O 或与内容提供程序交互，而所有这一切均可在后台进行。android系统本身提供了大量的Service组件，开发者可通过这些系统Service来操作android系统本身。</intent-filter...></p>
</blockquote>
<h1 id="两种启动方式的区别"><a href="#两种启动方式的区别" class="headerlink" title="两种启动方式的区别"></a>两种启动方式的区别</h1><blockquote>
<p><strong>startService</strong> 只是启动Service，启动它的组件（如Activity）和Service并没有关联，只有当Service调用stopSelf或者其他组件调用stopService服务才会终止。</p>
<p><strong>bindService</strong>方法启动Service，其他组件可以通过回调获取Service的代理对象和Service交互，而这两方也进行了绑定，当启动方销毁时，Service也会自动进行unBind操作，当发现所有绑定都进行了unBind时才会销毁Service.</p>
<p><strong>对生命周期的影响</strong><br><img src="http://upload-images.jianshu.io/upload_images/1685558-5b9c3263c0af2ea2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</blockquote>
<h2 id="Service的onCreate回调函数可以做耗时的操作吗？"><a href="#Service的onCreate回调函数可以做耗时的操作吗？" class="headerlink" title="Service的onCreate回调函数可以做耗时的操作吗？"></a>Service的onCreate回调函数可以做耗时的操作吗？</h2><blockquote>
<p>不能，看上面的生命周期图，onCreate回调在主线程里调用的，耗时操作会拥塞UI。</p>
</blockquote>
<h2 id="如果需要做耗时的操作，你会怎么做？"><a href="#如果需要做耗时的操作，你会怎么做？" class="headerlink" title="如果需要做耗时的操作，你会怎么做？"></a>如果需要做耗时的操作，你会怎么做？</h2><blockquote>
<p>这个问题作者也没给答案，大概就是另外开个子线程处理吧</p>
</blockquote>
<h1 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h1><blockquote>
<p>这个没咋弄，以后有空补上</p>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/02/28/java 设计模式之策略模式/">
                java 设计模式之策略模式
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-02-28</span>
            
            
                <a href="http://yoursite.com/2017/02/28/java 设计模式之策略模式/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/设计模式/">设计模式</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="java-设计模式之策略模式"><a href="#java-设计模式之策略模式" class="headerlink" title="java 设计模式之策略模式"></a>java 设计模式之策略模式</h1><blockquote>
<p>通常如果一个问题有多个解决方案时，最简单的方式就是利用if-else或者swich-case方式根据不同的情景选择不同的解决方案，但这种简单的方案问题太多，例如耦合性太高，代码臃肿，难以维护等。如果解决问题方案中包括大量的处理逻辑需要封装，或者处理方式变动较大的时候则就显得混乱，复杂，当需要增加一种方案是就需要修改类中的代码。怎么对于修改不关闭？不是说好的要遵循开闭原则吗？<br>应对这种情况策略模式就能很好地解决这列问题，它将各种方案分离开来，让客户端根据具体的需求来动态地选择不同的策略方案。<br>举个例子：用一个Calculator类来计算坐车的路费，车是有很多类型的，有公交车，地铁，火车，出租车等，当然每种车的车费计算方法是不一样的，所以用if-else的话，会在Calculator类里做很多类型判断，而且把各类型的计算方法也塞在里面了，试想一下，有一天需要时要增加一种车，那你只有在Calculator类多加个if，或者有一天需要要你改那种车的计费方法，你又在Calculator类里改，可以想象这样的改动是经常的，所以就有个问题，有增加或有改动，我可以不在Calculator类改动吗。可以的，策略模式</p>
</blockquote>
<h2 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h2><blockquote>
<ul>
<li><strong>Context</strong> 用来操作策略的上下文环境，比如上面说的Calculator类</li>
<li><strong>Stragety</strong> 策略的对象</li>
<li><strong>ConcreteStragetyA,ConcreteStragetyB</strong> 具体的策略实现</li>
</ul>
</blockquote>
<p><img src="http://ojgs96t5i.bkt.clouddn.com/QQ20170228212218.jpg" alt=""></p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PriceCalculator</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> Stragety stragety;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStragety</span><span class="params">(Stragety stragety)</span></span>&#123;</div><div class="line">		<span class="keyword">this</span>.stragety=stragety;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calculatePrice</span><span class="params">(<span class="keyword">int</span> km)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> price=<span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span> (stragety!=<span class="keyword">null</span>) &#123;</div><div class="line">		price=stragety.calculatePrice(km);</div><div class="line">	&#125;</div><div class="line">	System.out.println(String.valueOf(price));</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bus</span> <span class="keyword">implements</span> <span class="title">Stragety</span></span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculatePrice</span><span class="params">(<span class="keyword">int</span> km)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">3</span>*km;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Subway</span> <span class="keyword">implements</span> <span class="title">Stragety</span></span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculatePrice</span><span class="params">(<span class="keyword">int</span> km)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">5</span>*km;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Taxi</span> <span class="keyword">implements</span> <span class="title">Stragety</span></span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculatePrice</span><span class="params">(<span class="keyword">int</span> km)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">2</span>*km;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		PriceCalculator laowang=<span class="keyword">new</span> PriceCalculator();</div><div class="line">		laowang.setStragety(<span class="keyword">new</span> Bus());</div><div class="line">		laowang.calculatePrice(<span class="number">3</span>);</div><div class="line">		laowang.setStragety(<span class="keyword">new</span> Subway());</div><div class="line">		laowang.calculatePrice(<span class="number">3</span>);</div><div class="line">		laowang.setStragety(<span class="keyword">new</span> Taxi());</div><div class="line">		laowang.calculatePrice(<span class="number">3</span>);</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>使用if-else暴露的问题是代码臃肿，逻辑复杂，难以升级和维护，没有结构可言；策略模式是通过建立抽象，将不同的策略构建成一个具体的策略实现，通过不同的策略实现算法替换。在简化逻辑，结构的同时，增强了系统的可读性，稳定性，可扩展性。</p>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/01/24/ReactNative 体验/">
                ReactNative初体验
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-01-24</span>
            
            
                <a href="http://yoursite.com/2017/01/24/ReactNative 体验/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/ReactNative/">ReactNative</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="ReactNative-初体验"><a href="#ReactNative-初体验" class="headerlink" title="ReactNative 初体验"></a>ReactNative 初体验</h1><h2 id="配置（windows）"><a href="#配置（windows）" class="headerlink" title="配置（windows）"></a>配置（windows）</h2><ul>
<li>参考教程 <a href="https://facebook.github.io/react-native/docs/getting-started.html" target="_blank" rel="external">https://facebook.github.io/react-native/docs/getting-started.html</a></li>
<li>我首先是保证了在翻墙的环境安装这些软件的哈 ^-^</li>
<li><p>因为windows的终端命令行不是很方便,所以先安装chocolatey（<a href="https://chocolatey.org/），看官网好像说他是一个软件管理器。安装很简单，以管理员身份打开powerShell，然后贴如下代码执行" target="_blank" rel="external">https://chocolatey.org/），看官网好像说他是一个软件管理器。安装很简单，以管理员身份打开powerShell，然后贴如下代码执行</a></p>
<blockquote>
<p>iwr <a href="https://chocolatey.org/install.ps1" target="_blank" rel="external">https://chocolatey.org/install.ps1</a> -UseBasicParsing | iex<br>（安装时可能会出现禁止运行脚本的问题，可以参照这个方法解决。<a href="http://www.cnblogs.com/zhaozhan/archive/2012/06/01/2529384.html）" target="_blank" rel="external">http://www.cnblogs.com/zhaozhan/archive/2012/06/01/2529384.html）</a></p>
</blockquote>
</li>
<li><p>安装nodejs和python</p>
<blockquote>
<p>choco install nodejs.install<br>choco install python2</p>
</blockquote>
</li>
<li><p>nodejs安装完成后，会有npm,它也是个软件包管理器，用它就可以安装react-native了</p>
<blockquote>
<p>npm install -g react-native-cli</p>
</blockquote>
</li>
<li><p>android 开发环境配置，这个就不用说了，要注意的是要规范配置ANDROID_HOME这个环境变量，这个很简单，照文档做就是，如果不这样位置，那么只有在你的android工程中配置了。<br><img src="https://facebook.github.io/react-native/img/react-native-android-sdk-environment-variable-windows.png" alt=""></p>
</li>
</ul>
<h2 id="测试第一个react-native应用"><a href="#测试第一个react-native应用" class="headerlink" title="测试第一个react-native应用"></a>测试第一个react-native应用</h2><blockquote>
<p>上面那些都配置好，就可以构建react-native工程了</p>
</blockquote>
<ul>
<li><p>构建项目</p>
<blockquote>
<p>react-native init HelloWorld //这个是构建项目，名字为<br>cd HelloWorld<br>react-native start //这个我理解是启动react的服务，因为应用是通过js渲染的，正如网页有它的服务器一样，react也有他的服务。<br><strong>注意：</strong> 第一次构建应用它会自动安装很多东西，要等很久。</p>
</blockquote>
</li>
<li><p>启动应用</p>
<blockquote>
<p>react-native run-android //这个命令实际有两步。一是启动react服务（服务肯定是在电脑上运行啦），二是编译HelloWorld应用并安装在android设备上。所以当然可以手动分开执行<br>我是直接用的真机调试，所以只要保证手机应用能连得上电脑运行的react服务即可，我是通过USB数据线连的：</p>
<ul>
<li>保证设备和电脑连接，adb能起作用。</li>
<li>保证react服务在运行着。</li>
</ul>
</blockquote>
</li>
<li><p>到底啥样子<br>就是这个样子：<br><img src="http://ojgs96t5i.bkt.clouddn.com/Screenshot_2017-01-24-17-43-39-0852752002.png" alt=""></p>
</li>
</ul>
<blockquote>
<p>还有个特点，手机摇一下，界面就会弹出一个对话框，里面有个reload,我艹，这就安逸了，可以立刻刷新界面，像网页一样，这样调试时，手机只要摇一下就可以立马看到效果了，这可比原生开发快了好多倍！！！！！</p>
</blockquote>
<h2 id="实现Hello-World"><a href="#实现Hello-World" class="headerlink" title="实现Hello World"></a>实现Hello World</h2><blockquote>
<p>官方引导：React Native is like React, but it uses native components instead of web components as building blocks. So to understand the basic structure of a React Native app, you need to understand some of the basic React concepts, like JSX, components, state, and props. If you already know React, you still need to learn some React-Native-specific stuff, like the native components. This tutorial is aimed at all audiences, whether you have React experience or not.<br>上面说，react-native是用原生组件代替react的web组件，所以可想而知渲染效果肯定比网页的好。我一直都是学android原生应用开发的，没学过react，现在只知道他是前端框架，就照着代码验证理解好了。</p>
</blockquote>
<ul>
<li>分析代码 index.android.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Sample React Native App</div><div class="line"> * https://github.com/facebook/react-native</div><div class="line"> * @flow</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;<span class="comment">//这里导的是来自react的，估计是前端核心类</span></div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  AppRegistry,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;<span class="comment">//这里导的是来自react-native的，估计是提供界面组件的，而且这些组件是用原生组件渲染的</span></div><div class="line"><span class="comment">//输出默认的类HelloWorld，它是继承组件类的，render()暂时不晓得啥意思,return 包了个html,这个html应该就是显示的布局界面，看结构，外面是View，它包着里面的Text</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</div><div class="line">          HelloWorld</div><div class="line">        &lt;/Text&gt;</div><div class="line">      &lt;/View&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//这个应该是个组件样式库，包含container,welcome,instructions三个自定已样式，什么字体，颜色，背景都通过这个设置，很像android的style,只不过这个很像json格式来设置的</span></div><div class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</div><div class="line">  <span class="attr">container</span>: &#123;</div><div class="line">    <span class="attr">flex</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">justifyContent</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">alignItems</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">welcome</span>: &#123;</div><div class="line">    <span class="attr">fontSize</span>: <span class="number">20</span>,</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">margin</span>: <span class="number">10</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">instructions</span>: &#123;</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">color</span>: <span class="string">'#333333'</span>,</div><div class="line">    <span class="attr">marginBottom</span>: <span class="number">5</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;);</div><div class="line"><span class="comment">//这个应该是注册的意思吧</span></div><div class="line">AppRegistry.registerComponent(<span class="string">'HelloWorld'</span>, () =&gt; HelloWorld);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>保存，再reload<br><img src="http://ojgs96t5i.bkt.clouddn.com/Screenshot_2017-01-24-18-17-34-0202161002.png" alt=""></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/01/17/通用格式/">
                android adb常用命令
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-01-17</span>
            
            
                <a href="http://yoursite.com/2017/01/17/通用格式/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/Android/">Android</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="通用格式"><a href="#通用格式" class="headerlink" title="通用格式"></a>通用格式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb [-d|-e|-s&lt;serialNumber&gt;] &lt;command&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>命令通用格式,adb是必须的，接下来方括号[]里面的内容不是必须的，最后才是我们需要执行的命令操作，例如 adb -s emulator-5554 install xxxer.apk (这是安装xxx的意思)</p>
<ul>
<li>-d: 让唯一连接到该PC端的真实安卓设备执行命令，如果发现USB中连接有多部设备，将会报错</li>
<li>-e: 让唯一连接到该PC端的模拟器执行命令，如果发现开启了多个模拟器，将会报错</li>
<li>-s：通过设备的序列号进行指定设备执行命令<h3 id="部分命令"><a href="#部分命令" class="headerlink" title="部分命令"></a>部分命令</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获取连接设备列表</span></div><div class="line">adb devices</div><div class="line"><span class="comment">//给设备安装应用</span></div><div class="line">adb install apk绝对路径（如D:<span class="comment">//test.apk）</span></div><div class="line"><span class="comment">//将数据从设备复制到PC中,形象地说就是把设备的数据拉（pull）到电脑上</span></div><div class="line">adb pull &lt;设备数据文件绝对路径，如（/sdcard/test.txt）&gt; &lt;本地放文件的路径（如D:<span class="comment">//）&gt;</span></div><div class="line"><span class="comment">//将数据从PC端复制到设备中，形象地说就是把电脑的数据推（push）到设备上</span></div><div class="line">adb push &lt;本地文件的路径（如D:<span class="comment">//test.txt）&gt; &lt;设备放文件绝对路径，如（/sdcard/）&gt;</span></div><div class="line"><span class="comment">//获取连接到的手机的序列号</span></div><div class="line">adb get-serialno</div><div class="line"><span class="comment">//获取指定设备的连接状态</span></div><div class="line">adb -s &lt;serialNumber&gt; get-state</div><div class="line"><span class="comment">//adb-server的开启与关闭</span></div><div class="line">adb kill-server</div><div class="line">adb start-server</div><div class="line"><span class="comment">//屏幕录像</span></div><div class="line">adb shell screenrecord /sdcard/test.mp4</div></pre></td></tr></table></figure></li>
</ul>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/01/12/自定义View（一）/">
                自定义View
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-01-12</span>
            
            
                <a href="http://yoursite.com/2017/01/12/自定义View（一）/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/Android/">Android</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="自定义View的分类"><a href="#自定义View的分类" class="headerlink" title="自定义View的分类"></a>自定义View的分类</h1><blockquote>
<p> 笔记大多数内容都来自于《android 开发艺术探索》，我只是做了简化，加了些自己的理解</p>
</blockquote>
<ul>
<li>继承View重写onDraw方法<ul>
<li>主要用于实现一些不规则的效果，采用这种方式需要自己支持wrap_content,并且padding也需要自己处理。</li>
</ul>
</li>
<li>继承ViewGroup派生特殊的Layout<ul>
<li>主要用于实现自定义的布局，即除了LinearLayout,RelativeLayout,FrameLayout这几种系统的布局之外，重新定义一种新布局。这种方式需要合适地处理viewGroup的测量，布局这两个过程，并同时处理子元素的测量和布局过程。</li>
</ul>
</li>
<li>继承特定的View（如TextVeiw）<ul>
<li>常见方法，一般用于扩展某种已有的View的功能，比如TextView，这种方法比较容易实现，而且不需要自己支持wrap_content和padding等。</li>
</ul>
</li>
<li>继承特定的ViewGroup（如LinearLayout）<ul>
<li>当某种效果看起来很像几种View组合在一起的时候，可以采用这种方法实现，且不需要自己处理ViewGrounp的测量和布局这两个过程。<h1 id="自定义Veiw须知"><a href="#自定义Veiw须知" class="headerlink" title="自定义Veiw须知"></a>自定义Veiw须知</h1></li>
</ul>
</li>
</ul>
<ol>
<li>让View支持wrap_content</li>
<li>让View支持padding</li>
<li>尽量不要在view中使用handler，没必要，因为View本身就提供了post系列的方法。</li>
<li>View中如果有线程或者动画，需要及时停止。</li>
<li>View带有滑动嵌套情时，需要处理好滑动冲突。</li>
</ol>
<h1 id="View-的工作原理"><a href="#View-的工作原理" class="headerlink" title="View 的工作原理"></a>View 的工作原理</h1><h2 id="ViewRoot和DecorView"><a href="#ViewRoot和DecorView" class="headerlink" title="ViewRoot和DecorView"></a>ViewRoot和DecorView</h2><p>在ActivityThread中，当activity对象被创建完毕后，会将DecorView添加到Window中，同时会创建ViewRootImpl（ViewRoot）对象，并将ViewRoot对象和DecorView（顶级View）简历关联。</p>
<p>View的绘制流程是从ViewRoot的performTraversals方法开始的，经过Measure,layout,draw三个流程才能最终将一个View绘制出来</p>
<ul>
<li>measure  测量View的宽和高，完成后，可以通过getMeasuredWidth和getMeasuredHeight方法获得View测量后的宽和高，在大多情况下，它都等同于最终的宽和高，除了某些特殊情况。</li>
<li>layout   确定View在父容器中的放置位置</li>
<li>draw   将View绘制在屏幕</li>
</ul>
<p><img src="http://ojgs96t5i.bkt.clouddn.com/IMG_20170111_212444_EDIT_1.jpg" alt="performTraversals工作流程"></p>
<blockquote>
<p>图片来自《android开发艺术探索》</p>
</blockquote>
<ul>
<li>顶级View结构<br><img src="http://pic002.cnblogs.com/images/2012/328668/2012041014441235.jpg" alt=""></li>
</ul>
<blockquote>
<p>从图中可以知道，顶级View一般情况内部会包含一个竖直方向的LinearLayout,分为上下两个部分，上面是标题栏，下面是内容栏。内容栏的id为R.android.id.content,所以我们的content可以这样获得：ViewGroup content=findViewById(R.android,id.content),  得到我们设置的View:  content.getChildAt(0);  View层的事件都先经过DecorView，然后才传递给我们的View。</p>
</blockquote>
<h2 id="理解MeasureSpec"><a href="#理解MeasureSpec" class="headerlink" title="理解MeasureSpec"></a>理解MeasureSpec</h2><p>它在很大程度上决定了一个View的尺寸规格，因为过程中还受父容器的影响（父容器影响Vew的MeasureSpec创建过程），所以才说很大程度上。</p>
<h3 id="MeasureSpec类"><a href="#MeasureSpec类" class="headerlink" title="MeasureSpec类"></a>MeasureSpec类</h3><ul>
<li><strong>SpecMode</strong>  测量模式，实际上就是MeasureSpec的高2位值决定<ul>
<li><strong>SPECIFIED</strong>  父容器不对View有任何限制，要多大给多大，这种情况一般用于系统内部</li>
<li><strong>EXACTLY</strong> 父容器已经检测出View的所需要的精确大小，这个时候，View的最终大小就是SpecSize所指定的值。它对应于LayoutParams的中match_parent和具体的数值这两种模式。</li>
<li><strong>AT_MOST</strong>  父容器指定了一个可用大小即SpecSize，View的大小不能大于这个值，具体是什么值要看自己处理，它对应于LayoutParams中的wrap_content. </li>
</ul>
</li>
<li><strong>SpecSize</strong>  某种测量模式下的规格大小 ，实际上就是MeasureSpec的30低位值决定<h3 id="MeasureSpec-和-LayoutParams的关系"><a href="#MeasureSpec-和-LayoutParams的关系" class="headerlink" title="MeasureSpec 和 LayoutParams的关系"></a>MeasureSpec 和 LayoutParams的关系</h3></li>
<li>正常情况下，我们使用Veiw指定MeasureSpec，尽管如此，但我们可以给View设置LayoutParams，在view测量的时候，系统会将LayoutParams在父容器的约束下转换为对应的MeasureSpec，然后在根据这个MeasureSpec来确定View测量后的宽和高。也就是说，View的MeasureSpec使用父容器和设定的layoutParams共同决定的。MeasureSpec一旦确定后，onMeasure中就可以确定View的测量宽，高。</li>
</ul>
<h1 id="View的工作流程"><a href="#View的工作流程" class="headerlink" title="View的工作流程"></a>View的工作流程</h1><p><strong>即三大流程，measure,layout,draw（测量，布局和绘制）</strong></p>
<h2 id="onMeasure"><a href="#onMeasure" class="headerlink" title="onMeasure()"></a><strong>onMeasure()</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        <span class="keyword">int</span> widthSpecMode=MeasureSpec.getMode(widthMeasureSpec);</div><div class="line">        <span class="keyword">int</span> widthSpecSize=MeasureSpec.getSize(widthMeasureSpec);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> heightSpecMode=MeasureSpec.getMode(heightMeasureSpec);</div><div class="line">        <span class="keyword">int</span> heightSpecSize=MeasureSpec.getSize(heightMeasureSpec);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (widthSpecMode==MeasureSpec.AT_MOST&amp;&amp;heightSpecMode==MeasureSpec.AT_MOST)&#123;<span class="comment">//父容器已经指定了一个可用大小即SpecSize,View的大小不能大于这个值，具体是什么值要看不同的View的具体实现，它对应于LayoutParams中的wrap_content</span></div><div class="line">            setMeasuredDimension(<span class="number">200</span>,<span class="number">200</span>);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (widthSpecMode==MeasureSpec.AT_MOST)&#123;</div><div class="line">            setMeasuredDimension(<span class="number">200</span>,heightSpecSize);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (heightSpecMode==MeasureSpec.AT_MOST)&#123;</div><div class="line">            setMeasuredDimension(widthSpecSize,<span class="number">200</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="comment">//setMeasuredDimension是设置测量尺寸，200是默认的一个长度</span></div></pre></td></tr></table></figure>
<h2 id="获取View的测量宽和高"><a href="#获取View的测量宽和高" class="headerlink" title="获取View的测量宽和高"></a>获取View的测量宽和高</h2><blockquote>
<p><strong>因为activity的生命周期和View的测量周期不同步，所以在onCreate,onStart,onResume的无法保证能获取View的宽和高，要是View没测量完，这时候获取尺寸就为0.</strong></p>
</blockquote>
<pre><code>- 1.onWindowFocusChanged（）
    - 含义是View已经初始化完毕了，宽高已经准备好，这个时候去获取宽高是没问题的。注意：onWindowFocusChanged会被调用多次，当Activity继续执行或暂停执行时，onWindowFocusChanged均会被调用，
-  2.View.post(runnable)
    - 通过POST可以将一个runnable投递到消息队列的尾部，然后等待Looper调用此runnable的时候，View也可以初始化好了。
- 3.ViewTreeObserver
    -  这是个类，顾名思义是View树观察者，所以他有很多回调，其中有个接口OnGlobalLayoutListener，当View树的状态发生改变或者View树内部的View的可见性发生改变时，onGlobalLayout方法将被回调，因此这是获取view的宽高的好时机。
- 4.view.measure()，这种方法有点复杂，全是手动，略
</code></pre><h2 id="layout过程"><a href="#layout过程" class="headerlink" title="layout过程"></a>layout过程</h2><blockquote>
<p>layout的作用是ViewGroup用来确定子元素的位置，大致流程是：首先会通过setFrame方法设定View的四个顶点的位置，即初始化，然后会调用onLayout()。</p>
</blockquote>
<h2 id="draw过程"><a href="#draw过程" class="headerlink" title="draw过程"></a>draw过程</h2><blockquote>
<p>作用是将View绘制到屏幕上面。<br>绘制过程：</p>
<ul>
<li>绘制背景background.draw(canvas)</li>
<li>绘制自己onDraw()</li>
<li>绘制children(dispatchDraw)</li>
<li>绘制装饰（onDrawScrollBar）</li>
</ul>
</blockquote>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="继承View重写onDraw方法"><a href="#继承View重写onDraw方法" class="headerlink" title="- 继承View重写onDraw方法"></a>- 继承View重写onDraw方法</h2><blockquote>
<p> no code ,no bb,直接上代码  ，现在上一个简单的圆形控件代码</p>
</blockquote>
<ul>
<li><p>attrs.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">"CircleView"</span>&gt;</span></div><div class="line">	     <span class="comment">&lt;!--这个属性是圆形控件的颜色--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"cicle_color"</span> <span class="attr">format</span>=<span class="string">"color"</span>&gt;</span><span class="tag">&lt;/<span class="name">attr</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>CircleView.java<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mColor= Color.RED;<span class="comment">//默认画笔颜色</span></div><div class="line">    <span class="keyword">private</span> Paint mPaint=<span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);<span class="comment">//画笔</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context,attrs,<span class="number">0</span>);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 构造函数：获取属性值</div><div class="line"> */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        TypedArray typedArray=context.obtainStyledAttributes(attrs, R.styleable.CircleView);<span class="comment">//获取自定义的属性组</span></div><div class="line">        mColor=typedArray.getColor(R.styleable.CircleView_cicle_color,Color.RED);</div><div class="line">        typedArray.recycle();<span class="comment">//获取属性值，这里是圆形的颜色</span></div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 处理测量结果，说白了，这里是处理控件测量宽高，wrap不wrap的</div><div class="line"> */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        <span class="keyword">int</span> widthSpecMode=MeasureSpec.getMode(widthMeasureSpec);</div><div class="line">        <span class="keyword">int</span> widthSpecSize=MeasureSpec.getSize(widthMeasureSpec);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> heightSpecMode=MeasureSpec.getMode(heightMeasureSpec);</div><div class="line">        <span class="keyword">int</span> heightSpecSize=MeasureSpec.getSize(heightMeasureSpec);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (widthSpecMode==MeasureSpec.AT_MOST&amp;&amp;heightSpecMode==MeasureSpec.AT_MOST)&#123;<span class="comment">//父容器已经指定了一个可用大小即SpecSize,View的大小不能大于这个值，具体是什么值要看不同的View的具体实现，它对应于LayoutParams中的wrap_content</span></div><div class="line">            setMeasuredDimension(<span class="number">200</span>,<span class="number">200</span>);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (widthSpecMode==MeasureSpec.AT_MOST)&#123;</div><div class="line">            setMeasuredDimension(<span class="number">200</span>,heightSpecSize);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (heightSpecMode==MeasureSpec.AT_MOST)&#123;</div><div class="line">            setMeasuredDimension(widthSpecSize,<span class="number">200</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 绘制，先处理好padding,再确定圆心，半径，用装了颜色墨水的画笔画圆</div><div class="line"> */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        <span class="keyword">int</span> paddingLeft=getPaddingLeft();</div><div class="line">        <span class="keyword">int</span> paddingRight=getPaddingRight();</div><div class="line">        <span class="keyword">int</span> paddingTop=getPaddingTop();</div><div class="line">        <span class="keyword">int</span> paddingBottom=getPaddingBottom();</div><div class="line"></div><div class="line">        <span class="keyword">int</span> width=getWidth()-paddingLeft-paddingRight;</div><div class="line">        <span class="keyword">int</span> height=getHeight()-paddingBottom-paddingTop;</div><div class="line">        <span class="keyword">int</span> radius=Math.min(width,height)/<span class="number">2</span>;<span class="comment">//半径</span></div><div class="line">        canvas.drawCircle((width+paddingLeft)/<span class="number">2</span>,(height+paddingTop)/<span class="number">2</span>,radius,mPaint);<span class="comment">//参数：中心点x，y;半径；画笔</span></div><div class="line"></div><div class="line">    &#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 这里初始化时给画笔充墨水</div><div class="line"> */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">        mPaint.setColor(mColor);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">``` </div><div class="line">-  然后就可以在activity的布局文件里用上了</div><div class="line"> </div><div class="line">``` xml</div><div class="line"> &lt;com.newtrekwang.myapplication.MyWidgt.CircleView</div><div class="line">       android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">       app:cicle_color=<span class="string">"@color/colorAccent"</span></div><div class="line">       android:layout_height=<span class="string">"wrap_content"</span> /&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>效果<br><img src="http://ojgs96t5i.bkt.clouddn.com/layout-2017-01-08-220844.png" alt=""> </p>
</li>
</ul>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017/01/07/自定义Dialog样式/">
                自定义Dialog样式
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-01-07</span>
            
            
                <a href="http://yoursite.com/2017/01/07/自定义Dialog样式/#disqus_thread" class="comments article-comment-link">Kommentare</a>
            
            
                <span class="category">
                    <a href="/categories/Android/">Android</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="自定义Dialog样式"><a href="#自定义Dialog样式" class="headerlink" title="自定义Dialog样式"></a>自定义Dialog样式</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>平时项目开发总要自定义dialog满足产品的设计需求，但系统提供Dialog和AlertDialog用起来不是很方便，所以自己封装一个好用的Dialog基类是再好不过了。</p>
</blockquote>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><blockquote>
<p>BaseDialog.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.app.Dialog;</div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.content.DialogInterface;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.WindowManager;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by WJX .</div><div class="line"> * Desc: 一个便于自定义Dialog样式的基类</div><div class="line"> * Created on 2017/1/7 11:19.</div><div class="line"> * Mail:408030208@qq.com</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDialog</span> </span>&#123;</div><div class="line">    <span class="keyword">protected</span> Context context;</div><div class="line">    <span class="keyword">private</span> Dialog dialog;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getDialogStyleId</span><span class="params">()</span></span>;<span class="comment">//子类实现获取样式id</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> View <span class="title">getView</span><span class="params">()</span></span>;<span class="comment">//子类实现内容布局View</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">BaseDialog</span><span class="params">(Context context)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.context=context;</div><div class="line">        <span class="comment">//初始化基础对话框</span></div><div class="line">        <span class="keyword">if</span> (getDialogStyleId()==<span class="number">0</span>)&#123;</div><div class="line">            dialog=<span class="keyword">new</span> Dialog(context);</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            dialog=<span class="keyword">new</span> Dialog(context,getDialogStyleId());</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//dialog设置内容布局view</span></div><div class="line">        dialog.setContentView(getView());</div><div class="line">        <span class="comment">//关闭系统键盘</span></div><div class="line">        dialog.getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_STATE_ALWAYS_HIDDEN);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * dialog设置能否点击取消,链式</div><div class="line">     */</div><div class="line"><span class="function"><span class="keyword">public</span> BaseDialog <span class="title">setCancelable</span><span class="params">(<span class="keyword">boolean</span> cacel)</span></span>&#123;</div><div class="line">    dialog.setCancelable(cacel);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * dialog显示,链式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> BaseDialog <span class="title">show</span><span class="params">()</span></span>&#123;</div><div class="line">        dialog.show();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * dialog消失,链式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> BaseDialog  <span class="title">disMiss</span><span class="params">()</span></span>&#123;</div><div class="line">        dialog.dismiss();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * dialog是否在显示,链式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isShowing</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> dialog.isShowing();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * dialog消失监听,链式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> BaseDialog <span class="title">setOnDismissListener</span><span class="params">(DialogInterface.OnDismissListener dismissListener)</span></span>&#123;</div><div class="line">    dialog.setOnDismissListener(dismissListener);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * dialog取消监听,链式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> BaseDialog <span class="title">setOnCancelListener</span><span class="params">(DialogInterface.OnCancelListener cancelListener)</span></span>&#123;</div><div class="line">        dialog.setOnCancelListener(cancelListener);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * dialog显示监听,链式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> BaseDialog <span class="title">setOnShowListener</span><span class="params">(DialogInterface.OnShowListener onShowListener)</span></span>&#123;</div><div class="line">     dialog.setOnShowListener(onShowListener);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>YuanJiaoDialog.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by WJX .</div><div class="line"> * Desc: 一个圆角dialog</div><div class="line"> * Created on 2017/1/7 11:05.</div><div class="line"> * Mail:408030208@qq.com</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YuanJiaoDialog</span> <span class="keyword">extends</span> <span class="title">BaseDialog</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">YuanJiaoDialog</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getDialogStyleId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> R.style.dialog_style_one;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> View <span class="title">getView</span><span class="params">()</span> </span>&#123;</div><div class="line">        View view= LayoutInflater.from(context).inflate(R.layout.dialog_conent_layout,<span class="keyword">null</span>);</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>dialog_style_one</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"dialog_ios_style"</span> <span class="attr">parent</span>=<span class="string">"@android:style/Theme.Dialog"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="comment">&lt;!--window 背景，这里可以设置整个窗体的背景，不过会被窗体里面的内容布局覆盖，圆角，窗体大小在某种情况下可以通过这里的背景设置--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@drawable/yuanjiao_background<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowContentOverlay"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsFloating"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowFrame"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:backgroundDimEnabled"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowNoTitle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsTranslucent"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowMinWidthMajor"</span>&gt;</span>100%<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>  yuanjiao_background.xml  窗体背景布局xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    &gt;</div><div class="line">    <span class="tag">&lt;<span class="name">size</span> <span class="attr">android:height</span>=<span class="string">"200dp"</span> <span class="attr">android:width</span>=<span class="string">"200dp"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"20dp"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"@android:color/white"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div></pre></td></tr></table></figure>
<p><img src="/images/QQ截图20170107204110.jpg" alt=""></p>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="" href="/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/3/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2017/04/05/排序/">java实现基础算法</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/03/25/android IPC机制实现方式之AIDL/">android IPC机制实现方式之AIDL</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/03/25/android四大组件之Service/">android四大组件之Service</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/03/20/git学习笔记/">git学习笔记</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/Git/">Git</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/AIDL/">AIDL</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/android界面/">android界面</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/android四大组件/">android四大组件</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/Wangjiaxing123/">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/u/0/104493906013014839335">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'newtrek';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>